/* @license
jComponent + Tangular + jRouting
Copyright 2014-2016 Peter Širka All rights reserved.
Code licensed under MIT.
*/
var Tangular={};Tangular.helpers={},Tangular.version="v1.5.1",Tangular.cache={},Tangular.debug=!1,Tangular.settings={delimiters:["{{","}}"]},Tangular.register=function(name,fn){return Tangular.helpers[name]=fn,Tangular},Tangular.compile=function(str){str||(str="");for(var text,index=-1,builder=[],beg=-1,end=0,length=str.length,count=0,len=Tangular.settings.delimiters[0].length;length>index++;){var c=str.substring(index,index+len);if(-1===beg)if(c!==Tangular.settings.delimiters[0]);else{if(-1!==beg){count++;continue}text=str.substring(end,index),builder.push(text?'unescape("'+escape(text)+'")':'""'),beg=index+len}else if(c===Tangular.settings.delimiters[1]){if(count>0){count--;continue}builder.push(str.substring(beg,index).trim()),end=index+len,beg=-1;continue}}text=str.substring(end,length),builder.push(text?'unescape("'+escape(text)+'")':'""'),length=builder.length;for(var plus="$output+=",output='var $s=this,$output="",$t,$v;',skip=[],isEach=!1,eachCount=0,i=0;length>i;i++)if(i%2!==0){var cmd=builder[i],add=!1,index=cmd.lastIndexOf("|"),arr=null,cmd3=cmd.substring(0,3);"if "===cmd3&&(cmd="if( "+cmd.substring(3)+"){",add=!0),"foreach "===cmd.substring(0,8)&&(arr=cmd.split(" "),"var"===arr[1]&&arr.splice(1,1),skip.push(arr[1]),add=!0,isEach=!0,eachCount++);var cmd5=cmd.substring(0,5);if("endif"===cmd5||"fi"===cmd?(cmd="}",add=!0):"else"===cmd5?(cmd="} else {",add=!0):"else if"===cmd.substring(0,7)?(cmd="}else if( "+cmd.substring(8)+"){",add=!0):("end"===cmd3||"endfor"===cmd.substring(0,6))&&(cmd=skip.length?"}})()}":"}}",skip.pop(),add=!0,eachCount--,0===eachCount&&(isEach=!1)),cmd=add?Tangular.append(cmd,skip,isEach,"$s").trim():Tangular.helper(cmd,skip,isEach,"$s"),add){if(arr){var m=Tangular.append(arr[3],skip,isEach,"$s");cmd="if ("+m+"&&"+m+".length){(function(){for(var i=0,length="+m+".length;i<length;i++){var "+arr[1]+"="+m+"[i];var $index=i;"}output+=cmd}else output+=plus+cmd+";"}else output+=plus+builder[i]+";";var is=59===output.charCodeAt(output.length-1);return Tangular.debug&&(console.log("Tangular:"),console.log("function(helpers,$) {"+output+(is?"":";")+"return $output;"),console.log(str.trim()),console.log("---------------------------"),console.log("")),function(model,$){return new Function("helpers","$",output+(is?"":";")+"return $output;").call(model,function(name){var fn=Tangular.helpers[name];return fn?fn:(console.warn('Tangular helper "'+name+'" not found.'),function(value){return void 0===value?"undefined":null===value?"null":value.toString()})},$)}},Tangular.helper=function(line,skip,isEach){var property,index=line.indexOf("|");if(-1===index)return property=Tangular.append(line.trim(),skip,isEach,"$s").trim(),'helpers("encode").call($s,'+property+")";property=Tangular.append(line.substring(0,index).trim(),skip,isEach).trim(),line=line.substring(index+1).trim().split("|");for(var output="",i=0,length=line.length;length>i;i++){var name,helper=line[i].trim().replace("()","");index=helper.indexOf("("),-1===index?(name=helper,helper=".call($s,$t)"):(name=helper.substring(0,index),helper=".call($s,$t,"+helper.substring(index+1)),helper='$t=helpers("'+name+'")'+helper,output+=helper+";"}return'"";$t='+property+";"+output+"$output+=$t"},Tangular.append=function(line,skipl,isEach,model){return void 0===skipl&&(skipl=[]),line?line.replace(/[\_\$a-zá-žÁ-ŽA-Z0-9\s\.]+/g,function(word,index,text){var c=text.substring(index-1,index),skip=!1,updated=word.trim();switch(('"'===c||"'"===c||"."===c)&&(skip=!0),word.trim()){case"else":case"end":case"endfor":case"endif":case"fi":case"foreach":case"if":case"else if":return word;case"$index":if(!skip)return word}if(""===updated)return"";if(skip)return word;skip=!1;for(var j=0,length=skipl.length;length>j;j++){var l=skipl[j].length;if(updated.substring(0,l)===skipl[j]){if(updated.length!==l){var c=updated.substring(l,l+1);if("."!==c&&"+"!==c)continue}skip=!0;break}}if("$"===updated)return"Tangular.$wrap($)";if("$."===updated.substring(0,2)&&(model="$",updated=updated.substring(2)),skip)return updated;c=updated.substring(0,1);var code=c.charCodeAt(0);return code>47&&58>code?updated:"Tangular.$wrap("+(model||"$s")+',"'+updated+'")'}):"Tangular.$wrap("+(model||"$s")+")"},Tangular.$wrap=function(model,path,def){if(!model)return model;if(!path)return model;var arr=Tangular.cache[path];if(null===arr)return model[path];if(arr||(arr=path.split("."),Tangular.cache[path]=1===arr.length?null:arr),1===arr.length)return model[path];for(var tmp=model,i=0,length=arr.length;length>i;i++){var p=arr[i];if(tmp=tmp[p],!tmp)return i+1===length?tmp:def}return tmp},Tangular.render=function(template,model,repository){return(void 0===model||null===model)&&(model={}),"string"==typeof template&&(template=Tangular.compile(template)),template(model,repository)},Tangular.register("encode",function(value){return(void 0===value||null===value)&&(value=""),value.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),Tangular.register("raw",function(value){return(void 0===value||null===value)&&(value=""),value}),"undefined"!=typeof window&&(window.Tangular||(window.Tangular=Tangular),window.Ta=Tangular);
Tangular.register("format",function(r,t){var a=typeof r;if(void 0===r||null===r)return"";if("number"===a||r instanceof Date)return r.format(t);"string"!==a&&(r=r.toString()),r=r.trim();for(var e=!1,n=0,i=0,f=0,o=r.length;o>f;f++){var u=r.charCodeAt(f);if(58===u||32===u||84===u){e=!0;break}if(45===u){if(n++,1===n)continue;e=!0;break}if(46===u){if(i++,1===i)continue;e=!0;break}}return e?r.parseDate().format(t || "dd.MM.yyyy"):r.parseFloat().format(t)});
var JRFU={},jRouting={LIMIT_HISTORY:100,LIMIT_HISTORY_ERROR:100,version:"v1.2.0",cache:{},routes:[],history:[],errors:[],events:{},eventsOnce:{},global:{},query:{},params:[],middlewares:{},repository:{},url:"",model:null,isFirst:!0,isReady:!1,isRefresh:!1,isModernBrowser:"undefined"!=typeof history.pushState,count:0};jRouting.on=function(name,fn){var self=this,e=self.events[name];return e?(e.push(fn),self):(self.events[name]=[fn],self)},jRouting.once=function(name,fn){var self=this,e=self.eventsOnce[name];return e?(e.push(fn),self):(self.eventsOnce[name]=[fn],self)},jRouting.emit=function(name){var self=this,events=self.events[name]||[],eventsOnce=self.eventsOnce[name]||[],length=events.length,lengthOnce=eventsOnce.length;if(!length&&!lengthOnce)return self;for(var params=[],tmp=arguments.length,i=1;tmp>i;i++)params.push(arguments[i]);if(length>0)for(var i=0;length>i;i++)events[i].apply(self,params);if(lengthOnce){for(var i=0;length>i;i++)eventsOnce[i].apply(self,params);delete self.eventsOnce[name]}},jRouting.route=function(url,fn,middleware,init){var tmp;if(fn instanceof Array){var tmp=middleware;middleware=fn,fn=tmp}"function"==typeof middleware&&(tmp=init,init=middleware,middleware=tmp);var self=this,priority=url.count("/")+(-1===url.indexOf("*")?0:10),route=self._route(url.trim()),params=[];if("string"==typeof middleware&&(middleware=middleware.split(",")),-1!==url.indexOf("{")){priority-=100;for(var i=0;i<route.length;i++)"{"===route[i].substring(0,1)&&params.push(i);priority-=params.length}return self.routes.push({url:route,fn:fn,priority:priority,params:params,middleware:middleware||null,init:init,count:0,pending:!1}),self.routes.sort(function(a,b){return a.priority>b.priority?-1:a.priority<b.priority?1:0}),self},jRouting.middleware=function(name,fn){var self=this;return self.middlewares[name]=fn,self},jRouting.refresh=function(){var self=this;return self.location(self.url,!0)},jRouting.reload=function(){return jRouting.refresh()},jRouting._route=function(url){"/"===url.charIndex(0)&&(url=url.substring(1)),"/"===url.charIndex(url.length-1)&&(url=url.substring(0,url.length-1));var arr=url.split("/");return 1!==arr.length||arr[0]||(arr[0]="/"),arr},jRouting._route_param=function(routeUrl,route){var arr=[];if(!route||!routeUrl)return arr;var length=route.params.length;if(!length)return arr;for(var i=0;length>i;i++){var value=routeUrl[route.params[i]];arr.push("/"===value?"":value)}return arr},jRouting._route_compare=function(url,route){var length=url.length,skip=1===length&&"/"===url[0];if(route.length!==length)return!1;for(var i=0;length>i;i++){var value=route[i];if("undefined"==typeof value)return!1;if(skip||"{"!==value.charIndex(0)){if("*"===value)return!0;if(url[i]!==value)return!1}}return!0},jRouting.location=function(url,isRefresh){if(jRouting.isReady){var index=url.indexOf("?");-1!==index&&(url=url.substring(0,index)),url=JRFU.prepareUrl(url),url=JRFU.path(url);var self=this,path=self._route(url),routes=[],notfound=!0,raw=[];raw.push.apply(raw,path);for(var i=0,length=path.length;length>i;i++)path[i]=path[i].toLowerCase();self.isRefresh=isRefresh||!1,self.count++,isRefresh||self.url.length&&self.history[self.history.length-1]!==self.url&&(self.history.push(self.url),self.history.length>self.LIMIT_HISTORY&&self.history.shift());for(var length=self.routes.length,i=0;length>i;i++){var route=self.routes[i];if(self._route_compare(path,route.url)&&(-1===route.url.indexOf("*")&&(notfound=!1),!(route.once&&route.count>0))){route.count++,routes.push(route);break}}var isError=!1,error=[];self.url.length>0&&(self.cache[self.url]=self.repository),self.url=url,self.repository=self.cache[url],void 0===self.repository&&(self.repository={}),self._params(),self.params=self._route_param(raw,route),self.emit("location",url),length=routes.length;for(var i=0;length>i;i++){var route=routes[i];if(!route.pending)if(route.middleware&&route.middleware.length)!function(route){for(var l=route.middleware.length,middleware=[],j=0;l>j;j++)!function(route,fn){middleware.push(function(next){fn.call(self,next,route)})}(route,jRouting.middlewares[route.middleware[j]]);return route.init?(route.pending=!0,route.init(function(){middleware.middleware(function(){err||route.fn.apply(self,self.params),route.pending=!1})}),void(route.init=null)):(route.pending=!0,void middleware.middleware(function(err){err||route.fn.apply(self,self.params),route.pending=!1}))}(route);else{if(!route.init){route.fn.apply(self,self.params);continue}route.pending=!0,function(route){route.init(function(){route.fn.apply(self,self.params),route.pending=!1})}(route),route.init=null}}isError&&self.status(500,error),notfound&&self.status(404,new Error("Route not found."))}},jRouting.prev=function(){var self=this;return self.history[self.history.length-1]},jRouting.back=function(){var self=this,url=self.history.pop()||"/";return self.url="",self.redirect(url,!0),self},jRouting.status=function(code,message){var self=this;return self.emit("status",code||404,message),self},jRouting.redirect=function(url,model){var self=this;return self.isModernBrowser?(history.pushState(null,null,url),self.model=model||null,self.location(url,!1),self):(location.href=url,!1)},jRouting.cookie={get:function(name){for(var arr=document.cookie.split(";"),i=0;i<arr.length;i++){var c=arr[i];" "===c.charAt(0)&&(c=c.substring(1));var v=c.split("=");if(v.length>1&&v[0]===name)return v[1]}return""},set:function(name,value,expire){var expires="";if("number"==typeof expire){var date=new Date;date.setTime(date.getTime()+24*expire*60*60*1e3),expires="; expires="+date.toGMTString()}else expire instanceof Date&&(expires="; expires="+expire.toGMTString());document.cookie=name+"="+value+expires+"; path=/"},rem:function(name){this.set(name,"",-1)}},jRouting._params=function(){for(var self=this,data={},params=location.href.slice(location.href.indexOf("?")+1).split("&"),i=0;i<params.length;i++){var param=params[i].split("=");if(2===param.length){var name=decodeURIComponent(param[0]),value=decodeURIComponent(param[1]),isArray=data[name]instanceof Array;"undefined"==typeof data[name]||isArray||(data[name]=[data[name]]),isArray?data[name].push(value):data[name]=value}}return self.query=data,self},JRFU.path=function(url,d){"undefined"==typeof d&&(d="/");var index=url.indexOf("?"),params="";-1!==index&&(params=url.substring(index),url=url.substring(0,index));var c=url.charIndex(url.length-1);return c!==d&&(url+=d),url+params},String.prototype.count||(String.prototype.count=function(text){var index=0,count=0;do index=this.indexOf(text,index+text.length),index>0&&count++;while(index>0);return count}),String.prototype.charIndex||(String.prototype.charIndex=function(index){return this.toString().substring(index,index+1)}),jRouting.path=JRFU.path=function(url,d){"undefined"==typeof d&&(d="/");var index=url.indexOf("?"),params="";-1!==index&&(params=url.substring(index),url=url.substring(0,index));var c=url.charIndex(url.length-1);return c!==d&&(url+=d),url+params},JRFU.prepareUrl=function(url){return index=url.indexOf("#"),-1!==index?url.substring(0,index):url},Array.prototype.middleware||(Array.prototype.middleware=function(callback){var self=this,item=self.shift();return void 0===item?(callback&&callback(),self):(item(function(err){return err instanceof Error||err===!1?void(callback&&callback(err===!1?!0:err)):void setTimeout(function(){self.middleware(callback)},1)}),self)}),jRouting.on("error",function(err,url,name){var self=this;self.errors.push({error:err,url:url,name:name,date:new Date}),self.errors.length>self.LIMIT_HISTORY_ERROR&&self.errors.shift()}),$.fn.jRouting=function(g){if(!jRouting.isModernBrowser)return this;var handler=function(e){e.preventDefault(),jRouting.redirect($(this).attr("href"))};return g?($(document).on("click",this.selector,handler),this):(this.filter("a").bind("click",handler),this)},$(document).ready(function(){var url=location.pathname;jRouting.url=JRFU.path(JRFU.prepareUrl(url)),jRouting.events.ready?(jRouting.emit("ready",jRouting.url),jRouting.emit("load",jRouting.url)):setTimeout(function(){jRouting.isReady=!0,jRouting.location(jRouting.url),jRouting.emit("ready",jRouting.url),jRouting.emit("load",jRouting.url)},5),$(window).on("popstate",function(){if(jRouting.isReady){var url=location.hash||"";url.length||(url=location.pathname),jRouting.location(JRFU.path(url))}})}),window.jR=jRouting;
function $components_url(url){var index=url.indexOf("?"),builder=[];return COM.$version&&builder.push("version="+encodeURIComponent(COM.$version)),COM.$language&&builder.push("language="+encodeURIComponent(COM.$language)),builder.length?(url+=-1!==index?"&":"?",url+builder.join("&")):url}function $components_ready(){clearTimeout(MAN.timeout),MAN.timeout=setTimeout(function(){MAN.refresh(),MAN.initialize();var count=MAN.components.length;if($(document).trigger("components",[count]),MAN.isReady||(MAN.clear("valid","dirty","broadcast","find"),MAN.isReady=!0,COM.emit("init"),COM.emit("ready")),MAN.timeoutcleaner&&clearTimeout(MAN.timeoutcleaner),MAN.timeoutcleaner=setTimeout(function(){MAN.cleaner()},1e3),MAN.isCompiling=!1,$("["+COM_ATTR_S+"]").each(function(){if(!this.$ready){var scope=$(this);this.$ready=!0;var cls=scope.attr(COM_ATTR_C);cls&&!function(cls){cls=cls.split(" "),setTimeout(function(){for(var i=0,length=cls.length;length>i;i++)scope.toggleClass(cls[i])},5)}(cls);var controller=this.getAttribute("data-component-controller");if(controller){var ctrl=CONTROLLER(controller);ctrl&&ctrl.$init(void 0,this.getAttribute(COM_ATTR_S),scope)}var path=this.getAttribute(COM_ATTR_I);if(path)if(MAN.isOperation(path)){var op=OPERATION(path);op?op.call(scope,this.getAttribute(COM_ATTR_S),scope):console&&console.warn("The operation "+path+" not found.")}else{var fn=GET(path);"function"==typeof fn&&fn.call(scope,this.getAttribute(COM_ATTR_S),scope)}}}),MAN.ready){for(var arr=MAN.ready,i=0,length=arr.length;length>i;i++)arr[i](count);delete MAN.ready}},300)}function component_init(el,obj){var collection,type=el.get(0).tagName;"INPUT"===type||"SELECT"===type||"TEXTAREA"===type?(obj.$input=!0,collection=obj.element):collection=el.find(COM_DATA_BIND_SELECTOR),collection.each(function(){this.$component||(this.$component=obj)}),MAN.components.push(obj),MAN.init.push(obj),COM.compile(el),$components_ready()}function COM_P_COMPARE(a,b,type,ak,bk){var key=type+"="+ak+"="+bk,r=MAN.temp[key];if(void 0!==r)return r;if(0===type){for(var i=0,length=a.length;length>i;i++)if(void 0!==b[i]&&a[i]!==b[i])return MAN.temp[key]=!1,!1;return MAN.temp[key]=!0,!0}if(1===type){if(a.length!==b.length)return!1;for(var i=0,length=b.length;length>i;i++)if(a[i]!==b[i])return MAN.temp[key]=!1,!1;return MAN.temp[key]=!0,!0}if(2===type){for(var i=0,length=a.length;length>i;i++)if(void 0!==b[i]&&a[i]!==b[i])return MAN.temp[key]=!1,!1;return MAN.temp[key]=!0,!0}}function COMP(name){this._id="component"+Math.floor(1e5*Math.random()),this.$dirty=!0,this.$valid=!0,this.$validate=!1,this.$parser=new Array(0),this.$formatter=new Array(0),this.$skip=!1,this.$ready=!1,this.$path,this.trim=!0,this.middleware="",this.name=name,this.path,this.type,this.id,this.disabled=!1,this.caller,this.make,this.done,this.prerender,this.destroy,this.state,this.dependencies,this.validate,this.getter=function(value,type,older,skip){return value=this.parser(value),2===type&&(this.$skip=!0),2!==type||null!==older&&void 0!==older?(COM.validate(this.path),this):(this.trim&&"string"==typeof value&&(value=value.trim()),value===this.get()?this:(skip&&(this.$skip=!1),this.set(this.path+this.middleware,value,type),this))},this.setter=function(value,path,type){var self=this;if(2===type&&self.$skip)return self.$skip=!1,self;var selector=self.$input===!0?this.element:this.element.find(COM_DATA_BIND_SELECTOR);value=self.formatter(value),selector.each(function(){var path=this.$component.path;if(!path||!path.length||path===self.path){if("checkbox"===this.type){var tmp=null!==value&&void 0!==value?value.toString().toLowerCase():"";return void(this.checked="true"===tmp||"1"===tmp||"on"===tmp)}return(void 0===value||null===value)&&(value=""),"select-one"===this.type||"select"===this.type?void $(this).val(value):void(this.value=value)}})}}function component(type,declaration){return COMPONENT(type,declaration)}function COMPONENT(type,declaration){var shared={},fn=function(el){var obj=new COMP(type);return obj.global=shared,obj.element=el,obj.setPath(el.attr(COM_ATTR_P)||obj._id,!0),declaration.call(obj),obj};MAN.register[type]=fn}function component_async(arr,fn,done){var item=arr.shift();return void 0===item?void(done&&done()):void fn(item,function(){component_async(arr,fn,done)})}function CMAN(){this.isReady=!1,this.isCompiling=!1,this.init=[],this.register={},this.cache={},this.storage={},this.cacheblocked={},this.temp={},this.model={},this.components=[],this.schemas={},this.toggle=[],this.ready=[],this.events={},this.timeout,this.pending=[],this.imports={},this.timeoutStyles,this.styles=[],this.operations={},this.controllers={},this.initializers={},this.notvalid={},this.waits={},this.defaults={},this.middleware={}}function $components_keypress(self,old,e){self.value!==old&&(clearTimeout(self.$timeout),self.$timeout=null,self.value!==self.$value2&&(9!==e.keyCode&&self.$component.dirty(!1,!0),self.$component.getter(self.value,2,old,"focusout"===e.type||13===e.keyCode),self.value2=self.value),clearTimeout(self.$cleanupmemory),self.$cleanupmemory=setTimeout(function(){delete self.$value2,delete self.$value},3e5))}function $components_save(){COM.defaults.localstorage&&localStorage.setItem(COM.$localstorage+".cache",JSON.stringify(MAN.storage))}function SET(path,value,timeout,reset){return"boolean"==typeof timeout?COM.set(path,value,timeout):timeout?void setTimeout(function(){COM.set(path,value,reset)},timeout):COM.set(path,value,reset)}function INC(path,value,timeout,reset){return"boolean"==typeof timeout?COM.inc(path,value,timeout):timeout?void setTimeout(function(){COM.inc(path,value,reset)},timeout):COM.inc(path,value,reset)}function EXTEND(path,value,timeout,reset){return"boolean"==typeof timeout?COM.extend(path,value,timeout):timeout?void setTimeout(function(){COM.extend(path,value,reset)},timeout):COM.extend(path,value,reset)}function PUSH(path,value,timeout,reset){return"boolean"==typeof timeout?COM.push(path,value,timeout):timeout?void setTimeout(function(){COM.push(path,value,reset)},timeout):COM.push(path,value,reset)}function INVALID(path){$.components.invalid(path)}function RESET(path,timeout){return COM.reset(path,timeout)}function DEFAULT(path,timeout,reset){return COM["default"](path,timeout,null,reset)}function WATCH(path,callback,init){return COM.on("watch",path,callback,init)}function PING(url,timeout,callback){if(void 0===navigator.onLine||navigator.onLine){if("function"==typeof timeout){var tmp=callback;callback=timeout,timeout=tmp}var index=url.indexOf(" "),method="GET";-1!==index&&(method=url.substring(0,index).toUpperCase(),url=url.substring(index).trim());var options={},uri=$components_url(url);return options.type=method,options.headers={"X-Ping":location.pathname},options.success=function(r){return"string"==typeof callback?MAN.remap(callback,r):void(callback&&callback(r))},options.error=function(req,status,r){status=status+": "+r,COM.emit("error",r,status,url),"function"==typeof callback&&callback(void 0,status,url)},setInterval(function(){$.ajax(uri,options)},timeout||3e4)}}function AJAX(){return COM.AJAX.apply(COM,arguments)}function AJAXCACHE(){return COM.AJAXCACHE.apply(COM,arguments)}function GET(path,scope){return COM.get(path,scope)}function CACHE(key,value,expire){return COM.cache(key,value,expire)}function NOTIFY(){return COM.notify.apply(COM,arguments)}function NOTMODIFIED(path,value,fields){void 0===value&&(value=COM.get(path)),void 0===value&&(value=null),fields&&(path=path.concat("#",fields));var hash=HASH(JSON.stringify(value,fields)),key="notmodified."+path;return MAN.cache[key]===hash?!0:(MAN.cache[key]=hash,!1)}function FIND(value,many,noCache,callback){var isWaiting=!1;if("function"==typeof many?(isWaiting=!0,callback=many,many=void 0,noCache=void 0):"function"==typeof noCache&&(isWaiting=!0,callback=noCache,noCache=void 0),isWaiting)return void WAIT(function(){var val=FIND(value,many,noCache);return val instanceof Array?val.length>0:val?!0:!1},function(){callback(FIND(value,many))});var path,index=value.indexOf("[");-1!==index&&(path=value.substring(index+1,value.length-1),value=value.substring(0,index));var key,output;return!noCache&&(key="find."+value+"."+(many?0:1),output=MAN.cache[key])?output:46===value.charCodeAt(0)?(output=COM.findByPath(value.substring(1),many),noCache||(MAN.cache[key]=output),output):35===value.charCodeAt(0)?(output=COM.findById(value.substring(1),path,many),noCache||(MAN.cache[key]=output),output):(output=COM.findByName(value,path,many),noCache||(MAN.cache[key]=output),output)}function BROADCAST(selector,name,caller){if("object"==typeof selector){selector=selector.element?selector.element:$(selector);var components=[];return selector.find(COM_ATTR).each(function(){var com=$(this).data(COM_ATTR);com&&components.push(com)}),$BROADCAST_EVAL(components,name,caller)}var key="broadcast=";if("string"==typeof selector){if(key+=selector,MAN.cache[key])return $BROADCAST_EVAL(MAN.cache[key],name,caller);selector=selector.split(",")}else if(key+=selector.join(","),MAN.cache[key])return $BROADCAST_EVAL(MAN.cache[key],name,caller);for(var components=[],i=0,length=selector.length;length>i;i++){var item=selector[i].trim(),com=FIND(item,!0,!0);com&&components.push.apply(components,com)}return MAN.cache[key]=components,$BROADCAST_EVAL(components,name,caller)}function $BROADCAST_EVAL(components,name,caller){return caller||(caller=null),function(){for(var arg=arguments,i=0,length=components.length;length>i;i++){var component=components[i];"function"==typeof component[name]&&(component.caller=caller,component[name].apply(component[name],arg),component.caller=null)}}}function UPDATE(path,timeout,reset){return"boolean"==typeof timeout?COM.update(path,timeout):timeout?void setTimeout(function(){COM.update(path,reset)},timeout):COM.update(path,reset)}function CHANGE(path,value){return COM.change(path,value)}function INJECT(url,target,callback,timeout){return COM["import"](url,target,callback,timeout)}function IMPORT(url,target,callback,timeout){return COM["import"](url,target,callback,timeout)}function SCHEMA(name,declaration,callback){return COM.schema(name,declaration,callback)}function OPERATION(name,fn){return fn?(MAN.operations[name]=fn,fn):35===name.charCodeAt(0)?MAN.operations[name.substring(1)]:MAN.operations[name]}function ON(name,path,fn,init){COM.on(name,path,fn,init)}function EVALUATE(path,expression,nopath){return COM.evaluate(path,expression,nopath)}function MAKE(callback){var obj={};return callback.call(obj,obj),obj}function STYLE(value){clearTimeout(MAN.timeoutStyles),MAN.styles.push(value),MAN.timeoutStyles=setTimeout(function(){$('<style type="text/css">'+MAN.styles.join("")+"</style>").appendTo("head"),MAN.styles=[]},50)}function BLOCKED(name,timeout,callback){return COM.blocked(name,timeout,callback)}function HASH(s){if(!s)return 0;"string"!=typeof s&&(s=JSON.stringify(s));var i,char,hash=0;if(!s.length)return hash;var l=s.length;for(i=0;l>i;i++)char=s.charCodeAt(i),hash=(hash<<5)-hash+char,hash|=0;return hash}function WAIT(fn,callback,interval){var key=(1e4*Math.random()>>0).toString(16);if("number"==typeof callback){var tmp=interval;interval=callback,callback=tmp}var is="string"==typeof fn;MAN.waits[key]=setInterval(function(){if(is){var result=MAN.get(fn);if(void 0===result||null===result)return}else if(!fn())return;clearInterval(MAN.waits[key]),delete MAN.waits[key],callback&&callback(function(sleep){setTimeout(function(){WATCH(fn,callback,interval)},sleep||1)})},interval||500)}function COMPILE(){$.components()}function CONTROLLER(){var callback=arguments[arguments.length-1];if("function"!=typeof callback)return MAN.controllers[arguments[0]];var obj={};obj.name=obj.path=arguments[0];var replacer=function(path){var arg=arguments,is=!1;return path=path.replace(/\{\d+\}/g,function(text){return is=!0,arg[parseInt(text.substring(1,text.length-1))+1]}).replace(/\{\w+\}/g,function(text){return is=!0,obj[text.substring(1,text.length-1)]}),is?path:obj.path+"."+path};return MAN.controllers[obj.name]=obj,obj.$init=function(arg,path,element){return delete obj.$init,path&&(obj.path=path),obj.element=element,callback.call(obj,replacer,arg),obj}}function NOTVALID(name,value,error){if("function"==typeof value){var a={};return a={},a.fn=value,a.error=error,MAN.notvalid[name]=a,function(){for(var arg=[name],i=0;i<arguments.length;i++)arg.push(arguments[i]);return NOTVALID.apply(window,arg)}}var fn=MAN.notvalid[name];if(void 0===fn)return new Error('NOTVALID "'+name+'" does not exist.');for(var arg=[],i=1;i<arguments.length;i++)arg.push(arguments[i]);try{var response=fn.fn.apply(arguments[1],arg);return"string"==typeof response?response=new Error(response):response===!1?response=new Error("Unspecific Error Message"):(void 0===response||null===response||response===!0)&&(response=!1),response&&fn.error&&fn.error(response,value),response}catch(e){return fn.error&&fn.error(e,value),e}}function $MIDDLEWARE(path,value,type,callback){var index=path.indexOf(" #");if(-1===index)return callback(path,value),path;var a=path.substring(0,index);return void 0===value&&(value=COM.get(a)),MIDDLEWARE(path.substring(index+1).trim().replace(/\#/g,"").split(" "),value,function(value){callback(a,value)},a),a}function MIDDLEWARE(name,value,callback,path){if(!(name instanceof Array))return void(MAN.middleware[name]=value);if("function"!=typeof callback){var tmp=callback;callback=value,value=tmp}var context={};name.waitFor(function(name,next){var mid=MAN.middleware[name];return mid?void mid.call(context,next,value,path):(console.warn('Middleware "'+name+'" not found.'),void next())},function(val){callback&&callback.call(context,void 0!==val?val:value,path)})}function FN(exp){var index=exp.indexOf("=>"),arg=exp.substring(0,index).trim(),val=exp.substring(index+2).trim(),is=!1;arg=arg.replace(/\(|\)|\s/g,"").trim(),arg&&(arg=arg.split(",")),123===val.charCodeAt(0)&&(is=!0,val=val.substring(1,val.length-1).trim());var output=(is?"":"return ")+val;switch(arg.length){case 1:return new Function(arg[0],output);case 2:return new Function(arg[0],arg[1],output);case 3:return new Function(arg[0],arg[1],arg[2],output);case 4:return new Function(arg[0],arg[1],arg[2],arg[3],output);case 0:default:return new Function(output)}}var MAN=new CMAN,COM_DATA_BIND_SELECTOR="input[data-component-bind],textarea[data-component-bind],select[data-component-bind]",COM_ATTR="[data-component]",COM_ATTR_U="data-component-url",COM_ATTR_URL="["+COM_ATTR_U+"]",COM_ATTR_D="data-component-dependencies",COM_ATTR_P="data-component-path",COM_ATTR_T="data-component-template",COM_ATTR_I="data-component-init",COM_ATTR_V="data-component-value",COM_ATTR_R="data-component-removed",COM_ATTR_C="data-component-class",COM_ATTR_S="data-component-scope",COM_ATTR_X="data-component-import",REG_EMAIL=/^[a-z0-9-_.+]+@[a-z0-9.-]+\.[a-z]{2,6}$/i,REG_FORMAT=/\{\d+\}/g,isMOBILE="ontouchstart"in window||navigator.maxTouchPoints?!0:!1;"undefined"==typeof window.setImmediate&&(window.setImmediate=function(cb){setTimeout(cb,1)}),$.fn.component=function(){return this.data(COM_ATTR)},$.fn.components=function(fn){var all=this.find(COM_ATTR);return all.each(function(index){var com=$(this).data(COM_ATTR);com&&com.$ready&&!com.$removed&&fn.call(com,index)}),all},window.COM=window.jC=$.components=function(container){return MAN.isCompiling?COM:COM.compile(container)},COM.clean=function(timeout){return setTimeout(function(){MAN.cleaner()},timeout||10),COM},COM.evaluate=function(path,expression,nopath){var val,key="eval"+expression,exp=MAN.cache[key];return val=nopath?path:COM.get(path),void 0!==exp?exp.call(val,val,path):(-1===expression.indexOf("return")&&(expression="return "+expression),exp=new Function("value","path",expression),MAN.cache[key]=exp,exp.call(val,val,path))},COM.defaults={},COM.defaults.delay=300,COM.defaults.keypress=!0,COM.defaults.localstorage=!0,COM.version="v4.0.0",COM.$localstorage="jcomponent",COM.$version="",COM.$language="",COM.$formatter=new Array(0),COM.$parser=new Array(0),COM.$parser.push(function(path,value,type){if("number"===type||"currency"===type||"float"===type){"string"==typeof value&&(value=value.replace(/\s/g,"").replace(/,/g,"."));var v=parseFloat(value);return isNaN(v)&&(v=null),v}return value}),COM.compile=function(container){if(MAN.isCompiling=!0,COM.$inject(),MAN.pending.length)return MAN.pending.push(function(){COM.compile(container)}),COM;var els=container?container.find(COM_ATTR):$(COM_ATTR),skip=!1;if(!els.length&&!container)return void $components_ready();var scopes=$("["+COM_ATTR_S+"]"),scopes_length=scopes.length;return els.each(function(){if(!skip){var el=$(this),name=el.attr("data-component");if(!el.data(COM_ATTR)&&!el.attr(COM_ATTR_R)){if(MAN.initializers["$ST_"+name])return el.attr(COM_ATTR_R,!0),void el.remove();var component=MAN.register[name||""];if(!component){var x=el.attr(COM_ATTR_X);if(!x)return void(MAN.initializers["$NE_"+name]||(MAN.initializers["$NE_"+name]=!0,console.warn('The component "'+name+'" does not exist.')));if(1===MAN.imports[x])return;return 2===MAN.imports[x]?void(MAN.initializers["$NE_"+name]||(MAN.initializers["$NE_"+name]=!0,console.warn('The component "'+name+'" does not exist.'))):(MAN.imports[x]=1,void IMPORT(x,function(){MAN.imports[x]=2}))}var obj=component(el);obj.init&&(MAN.initializers[name]||(MAN.initializers[name]=!0,obj.init()),delete obj.init),obj.$init=el.attr(COM_ATTR_I)||null,obj.type=el.attr("data-component-type")||"",obj.id=el.attr("data-component-id")||obj._id,obj.dependencies=new Array(0),obj.$noscope||(obj.$noscope="true"===el.attr("data-component-noscope")),"true"===el.attr("data-component-singleton")&&(MAN.initializers["$ST_"+name]=!0);var code=obj.path?obj.path.charCodeAt(0):0;if(!obj.$noscope&&scopes_length&&obj.path&&33!==code&&35!==code)for(var i=0;scopes_length>i;i++)if($.contains(scopes[i],this)){var p=scopes[i].getAttribute(COM_ATTR_S);if(p&&"?"!==p||(p="scope"+(Math.floor(1e5*Math.random())+1e3),scopes[i].setAttribute(COM_ATTR_S,p)),!scopes[i].$processed){scopes[i].$processed=!0;var tmp=scopes[i].getAttribute(COM_ATTR_V);if(tmp){var fn=new Function("return "+tmp);MAN.defaults["#"+HASH(p)]=fn,MAN.set(p,fn())}}obj.setPath("?"===obj.path?p:p+"."+obj.path),obj.scope=scopes[i]}for(var dep=(el.attr(COM_ATTR_D)||"").split(","),i=0,length=dep.length;length>i;i++){var d=dep[i].trim();d&&obj.dependencies.push(d)}el.data(COM_ATTR,obj);var template=el.attr(COM_ATTR_T)||obj.template;if(template&&(obj.template=template),el.attr(COM_ATTR_U))return void console.warn("You cannot use [data-component-url] for the component: "+obj.name+"["+obj.path+"]. Instead of it you must use data-component-template.");if("string"==typeof template){var fn=function(data){obj.prerender&&(data=prerender(data)),"function"==typeof obj.make&&obj.make(data),component_init(el,obj)},c=template.substring(0,1);if("."===c||"#"===c||"["===c)return void fn($(c).html());var k="TE"+HASH(template),a=MAN.temp[k];return a?void fn(a):void $.get($components_url(template),function(response){MAN.temp[k]=response,fn(response)})}if("string"==typeof obj.make)return-1!==obj.make.indexOf("<")?(obj.prerender&&(obj.make=obj.prerender(obj.make)),el.html(obj.make),void component_init(el,obj)):void $.get($components_url(obj.make),function(data){obj.prerender&&(data=prerender(data)),el.html(data),component_init(el,obj)});obj.make&&obj.make()&&(skip=!0),component_init(el,obj)}}}),skip?void COM.compile():void 0!==container?void MAN.next():MAN.toggle.length?void component_async(MAN.toggle,function(item,next){for(var i=0,length=item.toggle.length;length>i;i++)item.element.toggleClass(item.toggle[i]);next()},function(){MAN.next()}):void MAN.next()},COM.$inject=function(){var els=$(COM_ATTR_URL),arr=[],count=0;els.each(function(){var el=$(this);el.data(COM_ATTR_URL)||(el.data(COM_ATTR_URL,"1"),arr.push({element:el,cb:el.attr(COM_ATTR_I),path:el.attr(COM_ATTR_P),url:el.attr(COM_ATTR_U),toggle:(el.attr(COM_ATTR_C)||"").split(" ")}))}),arr.length&&component_async(arr,function(item,next){item.element.load($components_url(item.url),function(){if(item.path){var com=item.element.find(COM_ATTR);com.each(function(){var el=$(this);$.each(this.attributes,function(){this.specified&&el.attr(this.name,this.value.replace("$",item.path))})})}if(item.toggle.length&&item.toggle[0]&&MAN.toggle.push(item),item.cb&&!item.element.attr("data-component")){var cb=MAN.get(item.cb);"function"==typeof cb&&cb(item.element)}count++,next()})},function(){MAN.clear("valid","dirty","broadcast","find"),0!==count&&COM.compile()})},COM.inject=COM["import"]=function(url,target,callback,insert){void 0===insert&&(insert=!0),"function"==typeof target&&(timeout=callback,callback=target,target="body"),target&&target.getPath&&(target=target.element),target||(target="body");var extension=url.lastIndexOf(".");extension=-1!==extension?url.substring(extension).toLowerCase():"";var d=document;if(".js"===extension){var script=d.createElement("script");return script.type="text/javascript",script.async=!0,callback&&(script.onload=callback),script.src=url,void d.getElementsByTagName("head")[0].appendChild(script)}if(".css"===extension){var style=d.createElement("link");return style.type="text/css",style.rel="stylesheet",style.href=url,void d.getElementsByTagName("head")[0].appendChild(style)}if(insert){var id='data-component-imported="'+(1e5*Math.random()>>0)+'"';$(target).append("<div "+id+"></div>"),target=$(target).find("> div["+id+"]")}return $(target).load($components_url(url),function(){COM.compile(),callback&&callback()}),COM},COM.createURL=function(url,values){"object"==typeof url&&(values=url,url=location.pathname+location.search);var query,index=url.indexOf("?");-1!==index?(query=COM.parseQuery(url.substring(index+1)),url=url.substring(0,index)):query={};for(var keys=Object.keys(values),i=0,length=keys.length;length>i;i++){var key=keys[i];query[key]=values[key]}var val=$.param(query,!0);return url+(val?"?"+val:"")},COM.parseCookie=COM.parseCookies=function(){for(var arr=document.cookie.split(";"),obj={},i=0,length=arr.length;length>i;i++){var line=arr[i].trim(),index=line.indexOf("=");-1!==index&&(obj[line.substring(0,index)]=decodeURIComponent(line.substring(index+1)))}return obj},COM.parseQuery=function(value){if(value||(value=location.search),!value)return{};var index=value.indexOf("?");-1!==index&&(value=value.substring(index+1));for(var arr=value.split("&"),obj={},i=0,length=arr.length;length>i;i++){var sub=arr[i].split("="),key=sub[0],val=decodeURIComponent((sub[1]||"").replace(/\+/g,"%20"));obj[key]?(obj[key]instanceof Array||(obj[key]=[obj[key]]),obj[key].push(val)):obj[key]=val}return obj},COM.UPLOAD=function(url,data,callback,timeout,progress,error){if(url||(url=location.pathname),"number"==typeof callback&&(timeout=callback,callback=void 0),"number"!=typeof timeout){var tmp=progress;error=progress,progress=timeout,timeout=tmp}return setTimeout(function(){var xhr=new XMLHttpRequest;xhr.addEventListener("load",function(){var r=this.responseText;try{r=JSON.parse(r)}catch(e){}return 200===this.status?"string"==typeof callback?MAN.remap(callback,r):void(callback&&callback(r)):(COM.emit("error",r,this.status,url),"string"==typeof error?MAN.remap(error,r):void(error?error(r,this.status):"function"==typeof callback&&callback(void 0,r,this.status)))},!1),xhr.upload.onprogress=function(evt){if(progress){var percentage=0;return evt.lengthComputable&&(percentage=Math.round(100*evt.loaded/evt.total)),"string"==typeof progress?MAN.remap(progress,percentage):void progress(percentage,evt.transferSpeed,evt.timeRemaining)}},xhr.open("POST",url),xhr.send(data)},timeout||0),COM},COM.POST=function(url,data,callback,timeout,error){return COM.AJAX("POST "+url,data,callback,timeout,error)},COM.PUT=function(url,data,callback,timeout,error){return COM.AJAX("PUT "+url,data,callback,timeout,error)},COM.TEMPLATE=function(url,callback,prepare){return MAN.cache[url]?("string"==typeof callback?SET(callback,MAN.cache[url]):callback(MAN.cache[url]),COM):(COM.GET(url,{},function(response){var value=MAN.cache[url]=prepare?prepare(response):response;"string"==typeof callback?SET(callback,value):callback(value)}),COM)},COM.GET=function(url,data,callback,timeout,error){return COM.AJAX("GET "+url,data,callback,timeout,error)},COM.DELETE=function(url,data,callback,timeout,error){return COM.AJAX("DELETE "+url,data,callback,timeout,error)},COM.GETCACHE=function(url,data,callback,expire,timeout,clear){return COM.AJAXCACHE("GET "+url,data,callback,expire,timeout,clear)},COM.POSTCACHE=function(url,data,callback,expire,timeout,clear){return COM.AJAXCACHE("POST "+url,data,callback,expire,timeout,clear)},COM.AJAX=function(url,data,callback,timeout,error){"function"==typeof url&&(error=timeout,timeout=callback,callback=data,data=url,url=location.pathname);var td=typeof data;if(("function"===td||"string"===td)&&(error=timeout,timeout=callback,callback=data,data=void 0),"boolean"==typeof timeout){var tmp=clear;clear=timeout,timeout=tmp}var index=url.indexOf(" ");if(-1===index)return COM;var method=url.substring(0,index).toUpperCase(),isCredentials="!"===method.substring(0,1);isCredentials&&(method=method.substring(1)),url=url.substring(index).trim(),index=url.indexOf(" #");var middleware="";return-1!==index&&(middleware=url.substring(index),url=url.substring(0,index)),setTimeout(function(){"GET"===method&&data&&(url+="?"+jQuery.param(data));var options={};return options.type=method,"GET"!==method&&(options.contentType="application/json; charset=utf-8",options.data=JSON.stringify(data)),options.success=function(r){return"string"==typeof callback?MAN.remap(callback,r):void(callback&&$MIDDLEWARE(middleware,r,1,function(path,value){callback(value)}))},url.match(/http\:\/\/|https\:\/\//i)&&(options.crossDomain=!0,isCredentials&&(options.xhrFields={withCredentials:!0})),options.error=function(req,status,r){return status=status+": "+r,COM.emit("error",r,status,url),"string"==typeof error?MAN.remap(error,r):void(error?error(r,status,url):"function"==typeof callback&&callback(void 0,status,url))},void 0===navigator.onLine||navigator.onLine?void $.ajax($components_url(url),options):void options.error(null,503,"You cannot access into the internet (offline).")},timeout||0),COM},COM.AJAXCACHE=function(url,data,callback,expire,timeout,clear){"function"==typeof url&&(error=timeout,timeout=callback,callback=data,data=url,url=location.pathname);var td=typeof data;if(("function"===td||"string"===td)&&(clear=timeout,timeout=expire,expire=callback,callback=data,data=void 0),"boolean"==typeof timeout){var tmp=clear;clear=timeout,timeout=tmp}var index=url.indexOf(" ");if(-1===index)return COM;var method=url.substring(0,index).toUpperCase(),uri=url.substring(index).trim();return setTimeout(function(){var value=clear?void 0:MAN.cacherest(method,uri,data);return void 0!==value?("string"==typeof callback?MAN.remap(callback,value):callback(value,!0),COM):void COM.AJAX(url,data,function(r,err){void 0===r&&(r=err),MAN.cacherest(method,uri,data,r,expire),"string"==typeof callback?MAN.remap(callback,r):callback(r,!1)})},timeout||1),COM},COM.cache=function(key,value,expire){return MAN.cachestorage(key,value,expire)},COM.removeCache=function(key,isSearching){if(isSearching)for(var m in MAN.storage)-1!==m.indexOf(key)&&delete MAN.storage[key];else delete MAN.storage[key];return $components_save(),COM},COM.REMOVECACHE=function(method,url,data){var index=method.indexOf(" ");-1!==index&&(data=url,url=method.substring(index).trim(),method=method.substring(0,index)),data=JSON.stringify(data);var key=HASH(method+"#"+url.replace(/\//g,"")+data).toString();return delete MAN.storage[key],$components_save(),COM},COM.ready=function(fn){return MAN.ready&&MAN.ready.push(fn),COM},COM.watch=function(path,fn,init){return COM.on("watch",path,fn),init?(fn.call(COM,path,MAN.get(path),0),COM):COM},COM.on=function(name,path,fn,init){"function"==typeof path?(fn=path,path=""):path=path.replace(".*","");var fixed=null;return 33===path.charCodeAt(0)&&(path=path.substring(1),fixed=path),MAN.events[path]?MAN.events[path][name]||(MAN.events[path][name]=[]):(MAN.events[path]={},MAN.events[path][name]=[]),MAN.events[path][name].push({fn:fn,id:this._id,path:fixed}),init?(fn.call(COM,path,MAN.get(path),!0),COM):COM},COM.$emit2=function(name,path,args){var e=MAN.events[path];if(!e)return!1;if(e=e[name],!e)return!1;for(var i=0,length=e.length;length>i;i++){var ev=e[i];ev.path&&ev.path!==path||ev.fn.apply(ev.context,args)}return!0},COM.$emitonly=function(name,paths,type,path){for(var unique={},keys=Object.keys(paths),a=0,al=keys.length;al>a;a++)for(var arr=keys[a].split("."),p="",b=0,bl=arr.length;bl>b;b++)p+=(p?".":"")+arr[b],unique[p]=paths[p];return COM.$emit2(name,"*",[path,unique[path],type]),Object.keys(unique).forEach(function(key){COM.$emit2(name,key,[path,unique[key],type])}),this},COM.$emit=function(name,path){if(path){for(var arr=path.split("."),args=[],length="watch"===name?3:arguments.length,i="watch"===name?1:2;length>i;i++)args.push(arguments[i]);"watch"===name&&args.push(arguments[3]),COM.$emit2(name,"*",args);for(var p="",i=0,length=arr.length;length>i;i++){var k=arr[i],a=arr[i];if("*"!==k){if("]"===a.substring(a.length-1,a.length)){var beg=a.lastIndexOf("[");a=a.substring(0,beg)}p+=i?".":"",args[1]=COM.get(p+k),COM.$emit2(name,p+k,args),k!==a&&COM.$emit2(name,p+a,args),p+=k}}return!0}},COM.emit=function(name){var e=MAN.events[""];if(!e)return!1;if(e=MAN.events[""][name],!e)return!1;for(var args=[],i=1,length=arguments.length;length>i;i++)args.push(arguments[i]);for(var i=0,length=e.length;length>i;i++){var context=e[i].context;(void 0===context||null!==context&&!context.$removed)&&e[i].fn.apply(context,args)}return!0},COM.change=function(path,value){return void 0===value?!COM.dirty(path):!COM.dirty(path,!value)},COM.valid=function(path,value,onlyComponent){var except,isExcept=value instanceof Array,key="valid"+path+(isExcept?">"+value.join("|"):"");if(isExcept&&(except=value,value=void 0),"boolean"!=typeof value&&void 0!==MAN.cache[key])return MAN.cache[key];var valid=!0,arr=void 0!==value?[]:null;return COM.each(function(obj,index,isAsterix){if(!isExcept||-1===except.indexOf(obj.path)){if(obj.disabled||obj.$valid_disabled)return void(arr&&obj.state&&arr.push(obj));if(void 0===value)return void(obj.$valid===!1&&(valid=!1));obj.state&&arr.push(obj),onlyComponent?onlyComponent._id===obj._id&&(obj.$valid=value):(isAsterix||obj.path===path)&&(obj.$valid=value,obj.$validate=!1),obj.$valid===!1&&(valid=!1)}},path,!0),MAN.clear("valid"),MAN.cache[key]=valid,COM.state(arr,1,1),valid},COM.dirty=function(path,value,onlyComponent,skipEmitState){var except,isExcept=value instanceof Array,key="dirty"+path+(isExcept?">"+value.join("|"):"");if(isExcept&&(except=value,value=void 0),"boolean"!=typeof value&&void 0!==MAN.cache[key])return MAN.cache[key];var dirty=!0,arr=void 0!==value?[]:null;return COM.each(function(obj,index,isAsterix){if(!isExcept||-1===except.indexOf(obj.path)){if(obj.disabled||obj.$dirty_disabled)return void(arr&&obj.state&&arr.push(obj));if(void 0===value)return void(obj.$dirty===!1&&(dirty=!1));obj.state&&arr.push(obj),onlyComponent?onlyComponent._id===obj._id&&(obj.$dirty=value):(isAsterix||obj.path===path)&&(obj.$dirty=value),obj.$dirty===!1&&(dirty=!1)}},path,!0),MAN.clear("dirty"),MAN.cache[key]=dirty,skipEmitState||COM.state(arr,1,2),dirty},COM.update=function(path,reset,type){var is=33===path.charCodeAt(0);return is&&(path=path.substring(1)),path=path.replace(/\.\*/,""),$MIDDLEWARE(path,void 0,type,function(path){if(!path)return COM;var state=[],was=!1,updates={},search=path;void 0===type&&(type=1);var A=search.split("."),AL=A.length;COM.each(function(component){if(component.path&&!component.disabled){for(var i=0;AL>i;i++)if(component.$$path[i]&&component.$$path[i]!==A[i])return;if(!component.$path||component.$path===path){var result=component.get();component.setter&&(component.$skip=!1,component.setter(result,path,type)),component.$ready=!0,reset===!0?(component.$dirty_disabled||(component.$dirty=!0),
component.$valid_disabled||(component.$valid=!0,component.$validate=!1,component.validate&&(component.$valid=component.validate(result))),component.element.find(COM_DATA_BIND_SELECTOR).each(function(){delete this.$value,delete this.$value2})):component.validate&&!component.$valid_disabled&&component.valid(component.validate(result),!0),component.state&&state.push(component),component.path===path&&(was=!0),updates[component.path]=result}}},is?path:void 0,void 0,is),reset&&MAN.clear("dirty","valid"),updates[path]||(updates[path]=COM.get(path));for(var i=0,length=state.length;length>i;i++)state[i].state(1,4);length=path.length,Object.keys(MAN.events).forEach(function(key){key.substring(0,length)===path&&(updates[key]=COM.get(key))}),COM.$emitonly("watch",updates,type,path)}),COM},COM.notify=function(){var arg=arguments,length=arguments.length;return COM.each(function(component){if(component.path&&!component.disabled){for(var is=!1,i=0;length>i;i++)if(component.path===arg[i]){is=!0;break}is&&component.setter(component.get(),component.path,1)}}),Object.keys(MAN.events).forEach(function(key){for(var is=!1,i=0;length>i;i++)if(key===arg[i]){is=!0;break}is&&COM.$emit2("watch",key,[key,COM.get(key)])}),COM},COM.extend=function(path,value,type){var val=COM.get(path);return(null===val||void 0===val)&&(val={}),COM.set(path,$.extend(val,value),type),COM},COM.nested=function(element,selector,type,value){if(element=$(element),"*"===selector)selector=null;else if(!(selector instanceof Array)){selector=selector.split(",");for(var nested=[],i=0,length=selector.length;length>i;i++){var item=selector[i].trim();item&&nested.push(item)}selector=nested.length?nested:null}var isEach="function"==typeof type;if(!isEach)switch(type){case"path":case"template":case"dependencies":case"class":case"url":case"type":case"init":case"bind":case"keypress":case"keypress-delay":case"keypress-only":type="data-component-"+type;break;case"delay":case"only":type="data-component-keypress-"+type}var self=this,replacer=function(current,value){return current&&-1!==current.indexOf("?")?current.replace("?",value):value};return selector?(element.find("[data-component]").each(function(){for(var el=$(this),id=el.attr("data-component-id"),pat=el.attr(COM_ATTR_P),name=el.attr("data-component"),i=0,length=selector.length;length>i;i++){var item=selector[i],is=!1;if(is=46===item.charCodeAt(0)?item.substring(1)===pat:35===item.charCodeAt(0)?item.substring(1)===id:item===name){var com=el.component();if(isEach)return void type(el,com);el.attr(type,type===COM_ATTR_P?replacer(el.attr(type),value):value),com&&type===COM_ATTR_P&&com.setPath(replacer(com.path,value))}}}),self):(element.find("[data-component]").each(function(){var el=$(this),com=el.component();return isEach?void type(el,com):(el.attr(type,type===COM_ATTR_P?replacer(el.attr(type),value):value),void(com&&type===COM_ATTR_P&&com.setPath(replacer(com.path,value))))}),self)},COM.set=function(path,val,type){return $MIDDLEWARE(path,val,type,function(path,value){var is=33===path.charCodeAt(0);if(is&&(path=path.substring(1)),43===path.charCodeAt(0))return path=path.substring(1),COM.push(path,value,type);if(!path)return COM;var isUpdate="object"==typeof value&&!(value instanceof Array)&&null!==value&&void 0!==value,reset=type===!0;if(reset&&(type=1),MAN.set(path,value,type),isUpdate)return COM.update(path,reset,type);var isChanged=val!==value,result=MAN.get(path),state=[];void 0===type&&(type=1);var A=path.split("."),AL=A.length;COM.each(function(component){if(component.path&&!component.disabled){for(var i=0;AL>i;i++)if(component.$$path[i]&&component.$$path[i]!==A[i])return;component.$path&&component.$path!==path||(component.path===path?component.setter&&(isChanged&&(component.$skip=!1),component.setter(result,path,type)):component.setter&&(isChanged&&(component.$skip=!1),component.setter(COM.get(component.path),path,type)),component.$ready=!0,component.state&&state.push(component),reset?(component.$dirty_disabled||(component.$dirty=!0),component.$valid_disabled||(component.$valid=!0,component.$validate=!1,component.validate&&(component.$valid=component.validate(result))),component.element.find(COM_DATA_BIND_SELECTOR).each(function(){delete this.$value,delete this.$value2})):component.validate&&!component.$valid_disabled&&component.valid(component.validate(result),!0))}},path,!0,is),reset&&MAN.clear("dirty","valid");for(var i=0,length=state.length;length>i;i++)state[i].state(type,5);COM.$emit("watch",path,void 0,type,is)}),COM},COM.push=function(path,value,type){var arr=COM.get(path),n=!1;arr instanceof Array||(arr=[],n=!0);var is=!0;return value instanceof Array?value.length?arr.push.apply(arr,value):is=!1:arr.push(value),n?COM.set(path,arr,type):is&&COM.update(path,type),self},COM.clean=function(){return MAN.cleaner(),COM},COM.get=function(path,scope){return MAN.get(path,scope)},COM.remove=function(path){if(path instanceof jQuery){path.find(COM_ATTR).attr(COM_ATTR_R,"true").each(function(){var com=$(this).data("component");com&&(com.$removed=!0)}),path.attr(COM_ATTR_T)&&path.attr(COM_ATTR_R,"true");var com=path.data("component");return com&&(com.$removed=!0),MAN.cleaner(),COM}return MAN.clear(),COM.each(function(obj){obj.remove(!0)},path),MAN.cleaner(),COM},COM.validate=function(path,except){var arr=[],valid=!0;return COM.each(function(obj){obj.disabled||except&&-1!==except.indexOf(obj.path)||(obj.state&&arr.push(obj),obj.$valid_disabled||(obj.$validate=!0,obj.validate&&(obj.$valid=obj.validate(MAN.get(obj.path)),obj.$valid||(valid=!1))))},path),MAN.clear("valid"),COM.state(arr,1,1),COM.$emit("validate",path),valid},COM.errors=function(path,except){path instanceof Array&&(except=path,path=void 0);var arr=[];return COM.each(function(obj){except&&-1!==except.indexOf(obj.path)||obj.$valid!==!1||obj.$valid_disabled||arr.push(obj)},path),arr},COM.can=function(path,except){return!COM.dirty(path,except)&&COM.valid(path,except)},COM.disabled=COM.disable=function(path,except){return COM.dirty(path,except)||!COM.valid(path,except)},COM.invalid=function(path,onlyComponent){return COM.dirty(path,!1,onlyComponent,!0),COM.valid(path,!1,onlyComponent),COM},COM.blocked=function(name,timeout,callback){var key=name,item=MAN.cacheblocked[key],now=Date.now();if(item>now)return!0;var local=COM.defaults.localstorage&&timeout>1e4;return MAN.cacheblocked[key]=now+timeout,local&&localStorage.setItem(COM.$localstorage+".blocked",JSON.stringify(MAN.cacheblocked)),callback&&callback(),!1},COM.state=function(arr,type,who){arr&&arr.length&&setTimeout(function(){for(var i=0,length=arr.length;length>i;i++)arr[i].state(type,who)},2)},COM.broadcast=function(selector,name,caller){return BROADCAST(selector,name,caller)},COM["default"]=function(path,timeout,onlyComponent,reset){if(timeout>0)return setTimeout(function(){COM["default"](path,0,onlyComponent,reset)},timeout),COM;"boolean"==typeof onlyComponent&&(reset=onlyComponent,onlyComponent=null),void 0===reset&&(reset=!0);var key=path.replace(/\.\*$/,""),fn=MAN.defaults["#"+HASH(key)];fn&&MAN.set(key,fn());var arr=[];return COM.each(function(obj){obj.disabled||(obj.state&&arr.push(obj),onlyComponent&&onlyComponent._id!==obj._id||(obj.$default&&obj.path&&obj.set(obj.path,obj.$default(),3),reset&&(obj.element.find(COM_DATA_BIND_SELECTOR).each(function(){delete this.$value,delete this.$value2}),obj.$dirty_disabled||(obj.$dirty=!0),obj.$valid_disabled||(obj.$valid=!0,obj.$validate=!1,obj.validate&&(obj.$valid=obj.validate(obj.get()))))))},path),COM.$emit("default",path),reset?(MAN.clear("valid","dirty"),COM.state(arr,3,3),COM.$emit("reset",path),COM):COM},COM.reset=function(path,timeout,onlyComponent){if(timeout>0)return setTimeout(function(){COM.reset(path)},timeout),COM;var arr=[];return COM.each(function(obj){obj.disabled||(obj.state&&arr.push(obj),onlyComponent&&onlyComponent._id!==obj._id||(obj.element.find(COM_DATA_BIND_SELECTOR).each(function(){delete this.$value,delete this.$value2}),obj.$dirty_disabled||(obj.$dirty=!0),obj.$valid_disabled||(obj.$valid=!0,obj.$validate=!1,obj.validate&&(obj.$valid=obj.validate(obj.get())))))},path),MAN.clear("valid","dirty"),COM.state(arr,1,3),COM.$emit("reset",path),COM},COM.findByName=function(name,path,callback){var tp=typeof path;("function"===tp||"boolean"===tp)&&(callback=path,path=void 0);var tc=typeof callback,isCallback="function"===tc,isMany="boolean"===tc;if(MAN.register[name]){var com;return isMany&&(callback=void 0,com=[]),COM.each(function(component){return component.name===name?isCallback?void callback(component):isMany?void com.push(component):(com=component,!0):void 0},path),isCallback?COM:com}return isMany?[]:void 0},COM.findByPath=function(path,callback){var tp=typeof path;("function"===tp||"boolean"===tp)&&(callback=path,path=void 0);var com,tc=typeof callback,isCallback="function"===tc,isMany="boolean"===tc;return isMany&&(callback=void 0,com=[]),COM.each(function(component){return isCallback?void callback(component):isMany?void com.push(component):(com=component,!0)},path),isCallback?COM:com},COM.findById=function(id,path,callback){var tp=typeof path;("function"===tp||"boolean"===tp)&&(callback=path,path=void 0);var com,tc=typeof callback,isCallback="function"===tc,isMany="boolean"===tc;return isMany&&(callback=void 0,com=[]),COM.each(function(component){return component.id===id?isCallback?void callback(component):isMany?void com.push(component):(com=component,!0):void 0},path),isCallback?COM:com},COM.schema=function(name,declaration,callback){if(!declaration)return $.extend(!0,{},MAN.schemas[name]);if("object"==typeof declaration)return MAN.schemas[name]=declaration,declaration;if("function"==typeof declaration){var f=declaration();return MAN.schemas[name]=f,f}if("string"!=typeof declaration)return void 0;var a=declaration.substring(0,1),b=declaration.substring(declaration.length-1);if('"'===a&&'"'===b||"["===a&&"]"===b||"{"===a&&"}"===b){var d=JSON.parse(declaration);return MAN.schemas[name]=d,callback&&callback(d),d}$.get($components_url(declaration),function(d){"string"==typeof d&&(d=JSON.parse(d)),MAN.schemas[name]=d,callback&&callback(d)})},COM.each=function(fn,path,watch,fix){var isAsterix=path?-1!==path.lastIndexOf("*"):!1;isAsterix&&(path=path.replace(".*",""));var $path;$path=path?path.split("."):new Array(0);for(var index=0,i=0,length=MAN.components.length;length>i;i++){var component=MAN.components[i];if(!(component.$removed||fix&&component.path!==path)){if(path){if(!component.path)continue;if(isAsterix){var a=COM_P_COMPARE($path,component.$$path,0,path,component.path);if(!a)continue}else if(path!==component.path){if(!watch)continue;var a=COM_P_COMPARE($path,component.$$path,2,path,component.path);if(!a)continue}}var stop=fn(component,index++,isAsterix);if(stop===!0)return COM}}return COM},COMP.prototype.update=COMP.prototype.refresh=function(){return this.set(this.path,this.get(),1),this},COMP.prototype.nested=function(selector,type,value){return COM.nested(this.element,selector,type,value),this},COMP.prototype.noscope=function(value){return this.$noscope=void 0===value?!0:value===!0,this},COMP.prototype.singleton=function(){var self=this;return MAN.initializers["$ST_"+self.name]=!0,self},COMP.prototype.readonly=function(){return this.noDirty(),this.noValid(),this.getter=null,this.setter=null,this.$parser=null,this.$formatter=null,this},COMP.prototype.broadcast=function(selector,name){return void 0===name?(name=selector,selector=this.dependencies):"*"===selector&&(selector=this),BROADCAST(selector,name,this)},COMP.prototype.noValid=function(val){return void 0===val&&(val=!0),this.$valid_disabled=val,this.$valid=val,this},COMP.prototype.noDirty=function(val){return void 0===val&&(val=!0),this.$dirty_disabled=val,this.$dirty=val?!1:!0,this},COMP.prototype.setPath=function(path,init){var fixed=null;33===path.charCodeAt(0)&&(path=path.substring(1),fixed=path);var index=path.indexOf(" #");return-1!==index?(this.middleware=path.substring(index),path=path.substring(0,index)):this.middleware="",this.path=path,this.$path=fixed,this.$$path=path.split("."),!init&&MAN.isReady&&MAN.refresh(),this},COMP.prototype.attr=function(name,value){var el=this.element;return void 0===value?el.attr(name):(el.attr(name,value),this)},COMP.prototype.html=function(value){var el=this.element,current=el.html();if(void 0===value)return current;if(value instanceof Array&&(value=value.join("")),value===current)return el;el.empty();var type=typeof value;return(value||"number"===type||"boolean"===type)&&el.append(value),el},COMP.prototype.empty=function(){var el=this.element;return el.empty(),el},COMP.prototype.append=function(value){var el=this.element;return value instanceof Array&&(value=value.join("")),value?el.append(value):el},COMP.prototype.find=function(selector){return this.element.find(selector)},COMP.prototype.isInvalid=function(){var is=!this.$valid;return is&&!this.$validate&&(is=!this.$dirty),is},COMP.prototype.watch=function(path,fn,init){var self=this;return"function"==typeof path&&(init=fn,fn=path,path=self.path),self.on("watch",path,fn),init?(fn.call(self,path,self.get(path),0),self):self},COMP.prototype.invalid=function(){return COM.invalid(this.path,this)},COMP.prototype.valid=function(value,noEmit){return void 0===value?this.$valid:this.$valid_disabled?this:(this.$valid=value,this.$validate=!1,MAN.clear("valid"),noEmit?this:(this.state&&this.state(1,1),this))},COMP.prototype.style=function(value){return STYLE(value),this},COMP.prototype.change=function(value){return void 0===value&&(value=!0),COM.change(this.path,value,this),this},COMP.prototype.dirty=function(value,noEmit){return void 0===value?this.$dirty:this.$dirty_disabled?this:(this.$dirty=value,MAN.clear("dirty"),noEmit?this:(this.state&&this.state(2,2),this))},COMP.prototype.reset=function(){return COM.reset(this.path,0,this),this},COMP.prototype.setDefault=function(value){return this.$default=function(){return value},this},COMP.prototype["default"]=function(reset){return COM["default"](this.path,0,this,reset),this},COMP.prototype.remove=function(noClear){return this.element.removeData(COM_ATTR),this.element.find(COM_ATTR).attr(COM_ATTR_R,"true"),this.element.attr(COM_ATTR_R,"true"),noClear||MAN.clear(),COM.$removed=!0,noClear||MAN.cleaner(),!0},COMP.prototype.on=function(name,path,fn,init){"function"==typeof path?(init=fn,fn=path,path=""):path=path.replace(".*","");var fixed=null;return 33===path.charCodeAt(0)&&(path=path.substring(1),fixed=path),MAN.events[path]?MAN.events[path][name]||(MAN.events[path][name]=[]):(MAN.events[path]={},MAN.events[path][name]=[]),MAN.events[path][name].push({fn:fn,context:this,id:this._id,path:fixed}),init?(fn.call(COM,path,MAN.get(path)),this):COM},COMP.prototype.formatter=function(value){if("function"==typeof value)return this.$formatter||(this.$formatter=[]),this.$formatter.push(value),this;var a=this.$formatter;if(a&&a.length)for(var i=0,length=a.length;length>i;i++)value=a[i].call(this,this.path,value,this.type);if(a=COM.$formatter,a&&a.length)for(var i=0,length=a.length;length>i;i++)value=a[i].call(this,this.path,value,this.type);return value},COMP.prototype.parser=function(value){if("function"==typeof value)return this.$parser||(this.$parser=[]),this.$parser.push(value),this;var a=this.$parser;if(a&&a.length)for(var i=0,length=a.length;length>i;i++)value=a[i].call(this,this.path,value,this.type);if(a=COM.$parser,a&&a.length)for(var i=0,length=a.length;length>i;i++)value=a[i].call(this,this.path,value,this.type);return value},COMP.prototype.emit=function(){COM.emit.apply(COM,arguments)},COMP.prototype.evaluate=function(path,expression,nopath){return expression||(expression=path,path=this.path),COM.evaluate(path,expression,nopath)},COMP.prototype.get=function(path){return path||(path=this.path),path?MAN.get(path):void 0},COMP.prototype.update=function(path,reset,type){COM.update(path||this.path,reset,type)},COMP.prototype.set=function(path,value,type){var self=this;return void 0===value&&(value=path,path=this.path),path?(COM.set(path,value,type),self):self},COMP.prototype.inc=function(path,value){var self=this;return void 0===value&&(value=path,path=this.path),path?(COM.inc(path,value),self):self},COMP.prototype.extend=function(path,value,type){var self=this;return void 0===value&&(value=path,path=this.path),path?(COM.extend(path,value,type),self):self},COMP.prototype.push=function(path,value,type){var self=this;return void 0===value&&(value=path,path=this.path),path?void COM.push(path,value,type,self):self},MAN.cacherest=function(method,url,params,value,expire){params&&!params.version&&COM.$version&&(params.version=COM.$version),params&&!params.language&&COM.$language&&(params.language=COM.$language),params=JSON.stringify(params);var key=HASH(method+"#"+url.replace(/\//g,"")+params).toString();return this.cachestorage(key,value,expire)},MAN.cachestorage=function(key,value,expire){var now=Date.now();if(void 0!==value)return this.storage[key]={expire:now+expire,value:value},void $components_save();var item=this.storage[key];return item&&item.expire>now?item.value:void 0},MAN.initialize=function(){var item=this.init.pop();return void 0===item?(COM.compile(),this):(item.$removed||this.prepare(item),this.initialize(),this)},MAN.remap=function(path,value){return $MIDDLEWARE(path,value,1,function(path,value){var index=path.indexOf("->");if(-1===index)return COM.set(path,value);var o=path.substring(0,index).trim(),n=path.substring(index+2).trim();COM.set(n,value[o])}),this},MAN.prepare=function(obj){if(!obj)return this;var tmp,value=obj.get(),el=obj.element;obj.setter&&(obj.$ready||(obj.$ready=!0,void 0===value&&(tmp=obj.attr(COM_ATTR_V),tmp&&(MAN.defaults[tmp]||(MAN.defaults[tmp]=new Function("return "+tmp)),obj.$default=MAN.defaults[tmp],value=obj.$default(),MAN.set(obj.path,value))),obj.setter(value,obj.path,0))),obj.validate&&!obj.$valid_disabled&&(obj.$valid=obj.validate(obj.get(),!0)),obj.done&&setTimeout(function(){obj.done()},20),obj.state&&obj.state(0,3),obj.$init&&setTimeout(function(){if(MAN.isOperation(obj.$init)){var op=OPERATION(obj.$init);return op&&op.call(obj,obj),void delete obj.$init}var fn=COM.get(obj.$init);"function"==typeof fn&&fn.call(obj,obj),delete obj.$init},5),el.trigger("component"),el.off("component");var cls=el.attr(COM_ATTR_C);return cls&&!function(cls){setTimeout(function(){cls=cls.split(" ");for(var i=0,length=cls.length;length>i;i++)el.toggleClass(cls[i])},5)}(cls),obj.id&&COM.emit("#"+obj.id,obj),COM.emit("@"+obj.name,obj),COM.emit("component",obj),this},MAN.next=function(){var next=this.pending.shift();return void 0===next?(this.isReady&&(this.isCompiling=!1),this):void next()},MAN.clear=function(){var self=this;if(!arguments.length)return self.cache={},self;for(var arr=Object.keys(self.cache),i=0,length=arr.length;length>i;i++){for(var key=arr[i],remove=!1,j=0;j<arguments.length;j++)if(key.substring(0,arguments[j].length)===arguments[j]){remove=!0;break}remove&&delete self.cache[key]}return self},MAN.isArray=function(path){var index=path.lastIndexOf("[");return-1===index?!1:(path=path.substring(index+1,path.length-1).substring(0,1),'"'===path||"'"===path?!1:!0)},MAN.isOperation=function(name){return 35===name.charCodeAt(0)?!0:!1},MAN.get=function(path,scope){if(35===path.charCodeAt(0)){var op=OPERATION(path);return op?op:function(){}}var cachekey="="+path,self=this;if(self.temp[cachekey])return self.temp[cachekey](scope||window);if(-1===path.indexOf("?")){for(var arr=path.split("."),builder=[],p="",i=0,length=arr.length-1;length>i;i++){var tmp=arr[i],index=tmp.lastIndexOf("[");-1!==index&&builder.push("if(!w."+(p?p+".":"")+tmp.substring(0,index)+")return"),p+=(""!==p?".":"")+arr[i],builder.push("if(!w."+p+")return")}var fn=new Function("w",builder.join(";")+";return w."+path.replace(/\'/,"'"));return self.temp[cachekey]=fn,fn(scope||window)}},MAN.set=function(path,value){if(35===path.charCodeAt(0)){var op=OPERATION(path);return op?op(value,path):console&&console.warn("The operation "+path+" not found."),self}var cachekey="+"+path,self=this;if(self.temp[cachekey])return self.cache[cachekey](window,value);if(-1!==path.indexOf("?"))return path="",self;for(var arr=path.split("."),builder=[],p="",i=0,length=arr.length;length>i;i++){p+=(""!==p?".":"")+arr[i];var type=self.isArray(arr[i])?"[]":"{}";{if(i===length-1){if("{}"===type)break;p=p.substring(0,p.lastIndexOf("[")),builder.push("if(!(w."+p+" instanceof Array))w."+p+"="+type);break}builder.push("if(typeof(w."+p+')!=="object"||w.'+p+"===null)w."+p+"="+type)}}var fn=new Function("w","a","b",builder.join(";")+";var v=typeof(a) === 'function' ? a(MAN.get(b)) : a;w."+path.replace(/\'/,"'")+"=v;return v");return self.cache[cachekey]=fn,fn(window,value,path),self},COM.inc=function(path,value,type){var current=COM.get(path);return current?"number"!=typeof current&&(current=parseFloat(current),isNaN(current)&&(current=0)):current=0,current+=value,COM.set(path,current,type),self},MAN.refresh=function(){var self=this;return clearTimeout(self.$refresh),self.$refresh=setTimeout(function(){self.components.sort(function(a,b){var al=a.path.length,bl=b.path.length;return al>bl?-1:al===bl?a.path.localeCompare(b.path):1})},200),self},MAN.cleaner=function(){for(var self=this,aks=Object.keys(self.events),is=!0,a=0,al=aks.length;al>a;a++){var ak=aks[a];if(self.events[ak])for(var bks=Object.keys(self.events[ak]),b=0,bl=bks.length;bl>b;b++){var bk=bks[b],arr=self.events[ak][bk];if(arr)for(var index=0;;){var item=arr[index++];if(void 0===item)break;void 0!==item.context&&(null===item.context||item.context.element&&item.context.element.closest(document.documentElement).length||(item.context&&item.context.element&&item.context.element.remove(),item.context.$removed=!0,item.context=null,self.events[ak][bk].splice(index-1,1),self.events[ak][bk].length||(delete self.events[ak][bk],Object.keys(self.events[ak]).length||delete self.events[ak]),index-=2,is=!0))}}}for(var index=0,length=MAN.components.length;length>index;){var component=MAN.components[index++];component?!component.element.closest(document.documentElement).length||component.attr(COM_ATTR_R)?(index--,COM.$emit("destroy",component.name,component),component.destroy&&component.destroy(),component.element.remove(),component.element=null,component.$removed=!0,component.path=null,component.setter=null,component.getter=null,MAN.components.splice(index,1),length=MAN.components.length,is=!0):(component.$parser&&!component.$parser.length&&delete component.$parser,component.$formatter&&!component.$formatter.length&&delete component.$formatter):(index--,MAN.components.splice(index,1),length=MAN.components.length)}MAN.clear("find");var now=Date.now(),is2=!1,is3=!1;for(var key in self.cacheblocked)self.cacheblocked[key]>now||(delete self.cacheblocked[key],is2=!0);COM.defaults.localstorage&&is2&&localStorage.setItem(COM.$localstorage+".blocked",JSON.stringify(self.cacheblocked));for(var key in self.storage){var item=self.storage[key];(!item.expire||item.expire<=now)&&(delete self.storage[key],is3=!0)}return is3&&$components_save(),is&&self.refresh(),self},MAN.$$=function(){if(delete MAN.$load,COM.defaults.localstorage){var cache=localStorage.getItem(COM.$localstorage+".cache");if(cache&&"string"==typeof cache)try{MAN.storage=JSON.parse(cache)}catch(e){}if(cache=localStorage.getItem(COM.$localstorage+".blocked"),cache&&"string"==typeof cache)try{MAN.cacheblocked=JSON.parse(cache)}catch(e){}}COM.compile()},COMPONENT("",function(){var self=this,type=self.element.get(0).tagName;if("INPUT"!==type&&"SELECT"!==type&&"TEXTAREA"!==type)self.readonly(),self.setter=function(value){value=self.formatter(value,!0),self.element.html(value)};else{var a="data-component-bind";self.element.attr(a)||self.element.attr(a,"1"),self.element.attr("required")&&(self.validate=function(value,is){return is?!0:value?!0:!1}),self.element.$component=self}}),setInterval(function(){MAN.temp={},MAN.cleaner()},3e5),MAN.$load=setTimeout(MAN.$$,2),$(document).ready(function(){MAN.$load&&(clearTimeout(MAN.$load),MAN.$$()),$(document).on("change keypress keydown blur",COM_DATA_BIND_SELECTOR,function(e){var self=this;if("keypress"!==e.type){var special="checkbox"===self.type||"radio"===self.type||"SELECT"===self.tagName;if(("focusout"!==e.type||!special)&&("change"!==e.type||special)&&self.$component&&!self.$component.$removed&&self.$component.getter){var code=e.keyCode;if((!(e.metaKey||9===code||code>15&&21>code||code>36&&41>code)||86===code&&88===code)&&(8!==e.keyCode||self.value)){if(self.$skip&&"focusout"===e.type)return void $components_keypress(self,self.$value,e);var value,old=self.$value;if(self.$value=null,"checkbox"===self.type||"radio"===self.type){if("keydown"===e.type)return;var value=self.checked;return self.$component.dirty(!1,!0),self.$component.getter(value,2),void(self.$component.$skip=!1)}if("SELECT"===self.tagName){if("keydown"===e.type)return;var selected=self[self.selectedIndex];return value=selected.value,self.$component.dirty(!1,!0),self.$component.getter(value,2),void(self.$component.$skip=!1)}if(void 0===self.$delay&&(self.$delay=parseInt(self.getAttribute("data-component-keypress-delay")||"0")),void 0===self.$only&&(self.$only="true"===self.getAttribute("data-component-keypress-only")),(!self.$only||"focusout"!==e.type&&"change"!==e.type)&&("keydown"!==e.type||void 0!==e.keyCode&&9!==e.keyCode)){if(e.keyCode<41&&8!==e.keyCode&&32!==e.keyCode){if(13!==e.keyCode)return;if("TEXTAREA"!==e.tagName)return self.$value=self.value,clearTimeout(self.$timeout),void $components_keypress(self,old,e)}if(void 0===self.$nokeypress){var v=self.getAttribute("data-component-keypress");self.$nokeypress=v?"false"===v:COM.defaults.keypress===!1}var delay=self.$delay;if(self.$nokeypress){if("keydown"===e.type||"focusout"===e.type)return;0===delay&&(delay=1)}else 0===delay&&(delay=COM.defaults.delay);"focusout"===e.type&&(delay=0),clearTimeout(self.$timeout),self.$timeout=setTimeout(function(){$components_keypress(self,old,e)},delay)}}}}else if("TEXTAREA"!==self.tagName&&13===e.keyCode)return!1}),setTimeout(function(){COM.compile()},2)}),Array.prototype.waitFor=function(fn,callback){void 0===fn.index&&(fn.index=0);var index=fn.index,self=this,item=self[fn.index++];return void 0===item?(callback&&callback(fn.value),delete fn.value,self):(fn.call(self,item,function(value){fn.value=value,self.waitFor(fn,callback)},index),self)},Array.prototype.async=function(context,callback){if("function"==typeof context){var tmp=callback;callback=context,context=tmp}context||(context={});var arr=this,index=0,c=function(){var fn=arr[index++];return void 0===fn?void(callback&&callback.call(context)):void fn.call(context,c,index-1)};return c(),this},String.prototype.isEmail=function(){var str=this;return str.length<=4?!1:REG_EMAIL.test(str)},String.prototype.parseInt=function(def){var str=this.trim(),num=+str;return isNaN(num)?def||0:num},String.prototype.parseFloat=function(def){var str=this.trim();-1!==str.indexOf(",")&&(str=str.replace(",","."));var num=+str;return isNaN(num)?def||0:num},Array.prototype.trim=function(){for(var self=this,output=[],i=0,length=self.length;length>i;i++)"string"==typeof self[i]&&(self[i]=self[i].trim()),self[i]&&output.push(self[i]);return output},Array.prototype.findIndex=function(cb,value){for(var self=this,isFN="function"==typeof cb,isV=void 0!==value,i=0,length=self.length;length>i;i++)if(isFN){if(cb.call(self,self[i],i))return i}else if(isV){if(self[i][cb]===value)return i}else if(self[i]===cb)return i;return-1},Array.prototype.findItem=function(cb,value){var index=this.findIndex(cb,value);if(-1!==index)return this[index]},Array.prototype.remove=function(cb,value){for(var self=this,arr=[],isFN="function"==typeof cb,isV=void 0!==value,i=0,length=self.length;length>i;i++)isFN?cb.call(self,self[i],i)||arr.push(self[i]):isV?self[i][cb]!==value&&arr.push(self[i]):self[i]!==cb&&arr.push(self[i]);return arr},Date.prototype.format=function(t){var e=this,r=!1;if(t&&33===t.charCodeAt(0)&&(r=!0,t=t.substring(1)),void 0===t||null===t||""===t)return e.getFullYear()+"-"+(e.getMonth()+1).toString().padLeft(2,"0")+"-"+e.getDate().toString().padLeft(2,"0")+"T"+e.getHours().toString().padLeft(2,"0")+":"+e.getMinutes().toString().padLeft(2,"0")+":"+e.getSeconds().toString().padLeft(2,"0")+":"+e.getMilliseconds().toString();var n=e.getHours();return r&&n>=12&&(n-=12),t.replace(/yyyy|yy|MM|M|dd|d|HH|H|hh|h|mm|m|ss|s|a|ww|w/g,function(t){switch(t){case"yyyy":return e.getFullYear();case"yy":return e.getYear();case"MM":return(e.getMonth()+1).toString().padLeft(2,"0");case"M":return e.getMonth()+1;case"dd":return e.getDate().toString().padLeft(2,"0");case"d":return e.getDate();case"HH":case"hh":return n.toString().padLeft(2,"0");case"H":case"h":return e.getHours();case"mm":return e.getMinutes().toString().padLeft(2,"0");case"m":return e.getMinutes();case"ss":return e.getSeconds().toString().padLeft(2,"0");case"s":return e.getSeconds();case"w":case"ww":var tmp=new Date(+e);return tmp.setHours(0,0,0),tmp.setDate(tmp.getDate()+4-(tmp.getDay()||7)),tmp=Math.ceil(((tmp-new Date(tmp.getFullYear(),0,1))/864e5+1)/7),"ww"===key?tmp.toString().padLeft(2,"0"):tmp;case"a":var r="AM";return e.getHours()>=12&&(r="PM"),r}})},Number.prototype.format=function(decimals,separator,separatorDecimal){var self=this,num=self.toString(),dec="",output="",minus="-"===num.substring(0,1)?"-":"";minus&&(num=num.substring(1));var index=num.indexOf(".");if("string"==typeof decimals){var tmp=separator;separator=decimals,decimals=tmp}void 0===separator&&(separator=" "),-1!==index&&(dec=num.substring(index+1),num=num.substring(0,index)),index=-1;for(var i=num.length-1;i>=0;i--)index++,index>0&&index%3===0&&(output=separator+output),output=num[i]+output;return(decimals||dec.length)&&(dec=dec.length>decimals?dec.substring(0,decimals):dec.padRight(decimals,"0")),dec.length&&void 0===separatorDecimal&&(separatorDecimal="."===separator?",":"."),minus+output+(dec.length?separatorDecimal+dec:"")},String.prototype.padLeft=function(t,e){var r=this.toString();return Array(Math.max(0,t-r.length+1)).join(e||"0")+r},String.prototype.padRight=function(t,e){var r=this.toString();return r+Array(Math.max(0,t-r.length+1)).join(e||"0")},String.prototype.format=function(){var arg=arguments;return this.replace(REG_FORMAT,function(text){var value=arg[+text.substring(1,text.length-1)];return(null===value||void 0===value)&&(value=""),value})},String.prototype.parseDate=function(){var self=this.trim();if(!self)return null;var lc=self.charCodeAt(self.length-1);if(41===lc)return new Date(self);if(90===lc)return new Date(Date.parse(self));var arr=self.split(-1===self.indexOf(" ")?"T":" "),index=arr[0].indexOf(":"),length=arr[0].length;if(-1!==index){var tmp=arr[1];arr[1]=arr[0],arr[0]=tmp}void 0===arr[0]&&(arr[0]="");for(var noTime=void 0===arr[1]?!0:0===arr[1].length,i=0;length>i;i++){var c=arr[0].charCodeAt(i);if(!(c>47&&58>c)&&45!==c&&46!==c&&noTime)return new Date(self)}void 0===arr[1]&&(arr[1]="00:00:00");var firstDay=-1===arr[0].indexOf("-"),date=(arr[0]||"").split(firstDay?".":"-"),time=(arr[1]||"").split(":"),parsed=[];if(date.length<4&&time.length<2)return new Date(self);index=(time[2]||"").indexOf("."),-1!==index?(time[3]=time[2].substring(index+1),time[2]=time[2].substring(0,index)):time[3]="0",parsed.push(+date[firstDay?2:0]),parsed.push(+date[1]),parsed.push(+date[firstDay?0:2]),parsed.push(+time[0]),parsed.push(+time[1]),parsed.push(+time[2]),parsed.push(+time[3]);for(var def=new Date,i=0,length=parsed.length;length>i;i++){isNaN(parsed[i])&&(parsed[i]=0);var value=parsed[i];if(0===value)switch(i){case 0:0>=value&&(parsed[i]=def.getFullYear());break;case 1:0>=value&&(parsed[i]=def.getMonth()+1);break;case 2:0>=value&&(parsed[i]=def.getDate())}}return new Date(parsed[0],parsed[1]-1,parsed[2],parsed[3],parsed[4],parsed[5])},Array.prototype.scalar=function(type,key){for(var output,isDate=!1,isAvg="avg"===type||"average"===type,isDistinct="distinct"===type,i=0,length=this.length;length>i;i++){var val=key?this[i][key]:this[i];
if("string"==typeof val&&(val=val.parseFloat()),val instanceof Date&&(isDate=!0,val=val.getTime()),isDistinct)output||(output=[]),-1===output.indexOf(val)&&output.push(val);else if("median"!==type)if("sum"===type||isAvg)output?output+=val:output=val;else switch("range"!==type?output||(output=val):output||(output=new Array(2),output[0]=val,output[1]=val),type){case"range":output[0]=Math.min(output[0],val),output[1]=Math.max(output[1],val);break;case"min":output=Math.min(output,val);break;case"max":output=Math.max(output,val)}else output||(output=[]),output.push(val)}if(isDistinct)return output;if(isAvg)return output/=this.length,isDate?new Date(output):output;if("median"===type){output.sort(function(a,b){return a-b});var half=Math.floor(output.length/2);output=output.length%2?output[half]:(output[half-1]+output[half])/2}if(isDate){if("number"==typeof output)return new Date(output);output[0]=new Date(output[0]),output[1]=new Date(output[1])}return output};