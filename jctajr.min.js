/* @license
jComponent + Tangular + jRouting
Copyright 2014-2015 Peter Å irka All rights reserved.
Code licensed under MIT.
*/
var Thelpers={},Tangular={};Tangular.register=function(n,r){Thelpers[n]=r},Tangular.compile=function(n){n||(n="");for(var r=-1,e=[],i=-1,s=0,t=n.length,u=0;t>r++;){var a=n.substring(r,r+2);if(-1===i)if("{{"!==a);else{if(-1!==i){u++;continue}var l=n.substring(s,r);e.push(l?'unescape("'+escape(l)+'")':'""'),i=r+2}else if("}}"===a){if(u>0){u--;continue}e.push(n.substring(i,r).trim()),s=r+2,i=-1;continue}}e.push('unescape("'+escape(n.substring(s,t))+'")'),t=e.length;for(var g="$output+=",f='var $s=this;var $output="";',o=[],p=!1,c=0,h=0;t>h;h++)if(h%2!==0){var v=e[h],d=!1,r=v.lastIndexOf("|"),b="helpers.encode(@)",T=null,$=v.substring(0,3);"if "===$&&(v="if( "+v.substring(3)+"){",d=!0),"foreach "===v.substring(0,8)&&(T=v.split(" "),"var"===T[1]&&T.splice(1,1),o.push(T[1]),d=!0,p=!0,c++);var m=v.substring(0,5);if("endif"===m||"fi"===v?(v="}",d=!0):"else"===m?(v="} else {",d=!0):("end"===$||"endfor"===v.substring(0,6))&&(v=0===o.length?"}":"}})();",o.pop(),d=!0,c--,0===c&&(p=!1)),d)v=Tangular.append(v,o,p).trim();else{if(-1!==r){b=v.substring(r+1).trim(),v=v.substring(0,r),r=b.indexOf("(");var x=b;if(-1===r?b+="(@)":(x=b.substring(0,r),b=b.substring(0,r+1)+"@"+(-1===b.indexOf("()")?",":"")+b.substring(r+1)),b="helpers."+b,void 0===Thelpers[x])throw new Error('Helper: "'+x+'" not found.')}r=b.indexOf("("),b=b.substring(0,r)+".call($s,"+b.substring(r+1),v=b.replace("@",Tangular.append(v,o,p).trim())}if(d){if(T){var w=Tangular.append(T[3],o,p);v="if ("+w+"===null||"+w+"===undefined)"+w+"=[];(function(){for(var i=0,length="+w+".length;i<length;i++){var "+T[1]+"="+w+"[i];var $index=i;"}f+=v}else f+=g+v+";"}else f+=g+e[h]+";";return function(n){return new Function("helpers",f+";return $output;").call(n,Thelpers)}},Tangular.append=function(n,r,e){var i=[],s=n.split(" ");void 0===r&&(r=[]);for(var t=r.length,u=0,a=s.length;a>u;u++){var l=s[u],g=l.charCodeAt(0);if(g>64&&91>g||g>96&&123>g||36===g||95===g||33===g){var f=l.substring(0,5);if("if"===l.substring(0,2)||"endif"===f||"else"===f||"endfor"===l.substring(0,6)||"foreach"===l.substring(0,7)){i.push(l);continue}var o="!"===l.substring(0,1),p=!1;o&&(l=l.substring(1));for(var c=0;t>c;c++){var h=r[c].length;if(l.substring(0,h)===r[c]){if(l.length!==h){var v=l.substring(h,h+1);if("."!==v&&"+"!==v)continue}p=!0;break}}if(p){i.push((o?"!":"")+l);continue}if(e&&null!==l.match(/^\$index(\s|$)/g)){i.push((o?"!":"")+l);continue}var v=l.trim().substring(0,1);if("="===v||"."===v||","===v||"!"===v||"+"===v||"-"===v){i.push((o?"!":"")+l);continue}i.push((o?"!":"")+"$s."+l)}else i.push(l)}return i.join(" ")},Tangular.render=function(n,r){return(void 0===r||null===r)&&(r={}),"string"==typeof n&&(n=Tangular.compile(n)),n(r)},Tangular.register("encode",function(n){return(void 0===n||null===n)&&(n=""),n.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),Tangular.register("raw",function(n){return(void 0===n||null===n)&&(n=""),n});
function $components_url(t){var n=t.indexOf("?"),e=[];return $.components.$version&&e.push("version="+encodeURIComponent($.components.$version)),$.components.$language&&e.push("language="+encodeURIComponent($.components.$language)),0===e.length?t:(t+=-1!==n?"&":"?",t+e.join("&"))}function $components_ready(){clearTimeout($cmanager.timeout),$cmanager.timeout=setTimeout(function(){$cmanager.initialize();var t=$cmanager.components.length;if($(document).trigger("components",[t]),$cmanager.isReady||($cmanager.clear(),$cmanager.isReady=!0,$.components.emit("init"),$.components.emit("ready")),$cmanager.isCompiling=!1,$cmanager.ready){for(var n=$cmanager.ready,e=0,o=n.length;o>e;e++)n[e](t);delete $cmanager.ready}},100)}function component_init(t,n){function e(t,e){var o=t.get(0),a=t.attr("data-component-bind");if(!(a&&a.length>0&&a!==n.path)&&n.getter){n.dirty(!1);var r="checkbox"===o.type?o.checked:t.val();if(n.$value===r)return void(e&&n.setter(n.get()));n.$value=r,n.dirty(!1),n.getter(r,2),e&&n.setter(n.get())}}function o(t){var n=$(this);if("SELECT"!==this.tagName&&"blur"===t.type)return clearTimeout(n.data("delay")),n.data("skip",t.type),void e(n,!0);if("change"===t.type){if("SELECT"!==this.tagName){var o=this.type.toLowerCase();if("checkbox"!==o&&"radio"!==o)return;return void e(n)}return void e(n)}var a=n.data("skip");return a&&a!==t.type?void n.removeData("skip"):(clearTimeout(n.data("delay")),void n.data("delay",setTimeout(function(){n.data("skip",t.type),e(n)},300)))}var a,r=t.get(0).tagName;"INPUT"===r||"SELECT"===r||"TEXTAREA"===r?""===n.type&&(n.$input=!0,a=t):a=t.find(COM_DATA_BIND_SELECTOR),a.each(function(){var t=$(this);t.data("binded")||(t.data("binded",!0),t.bind("change blur keyup",o).attr("data-component-bind",n.path))}),$cmanager.components.push(n),$cmanager.init.push(n),$.components.compile(t),$components_ready()}function Component(t){this._id="component"+Math.floor(1e5*Math.random()),this.$dirty=!0,this.$valid=!0,this.$validate=!1,this.$parser=[],this.$formatter=[],this.$value,this.$skip=!1,this.name=t,this.path,this.type,this.id,this.make,this.done,this.watch=null,this.prerender,this.destroy,this.state,this.validate,this.getter=function(t,n){return t=this.parser(t),2===n&&(this.$skip=!0),this.set(this.path,t,n),this},this.setter=function(t,n){var e=this;if(2===n&&e.$skip===!0)return e.$skip=!1,e;var o=e.$input===!0?this.element:this.element.find(COM_DATA_BIND_SELECTOR);t=e.formatter(t);var a=null!==t&&void 0!==t?t.toString().toLowerCase():"";o.each(function(){var n=$(this),o=n.attr("data-component-bind");return o&&o.length>0&&o!==e.path?void 0:"checkbox"===this.type?(e.$value="true"===a||"1"===a||"on"===a,void(this.checked=e.$value)):((void 0===t||null===t)&&(t=""),"select-one"===this.type?(e.$value=t,void n.val(t)):void(e.$value=this.value=t))})},this.$parser.push(function(t,n,e){if("number"===e){"string"==typeof n&&(n=n.replace(/\s/g,"").replace(/,/g,"."));var o=parseFloat(n);return isNaN(o)&&(o=null),o}return n})}function component(t,n){return COMPONENT(t,n)}function COMPONENT(t,n){var e=function(e){var o=new Component(t);return o.element=e,o.path=e.attr(COM_ATTR_P),n.call(o),o};$cmanager.register[t]=e}function component_async(t,n,e){var o=t.shift();return void 0===o?void(e&&e()):void n(o,function(){component_async(t,n,e)})}function ComponentManager(){this.isReady=!1,this.isCompiling=!1,this.init=[],this.register={},this.cache={},this.model={},this.components=[],this.schemas={},this.toggle=[],this.ready=[],this.events={},this.timeout,this.pending=[]}function SET(t,n){return $.components.set(t,n)}function RESET(t){return $.components.reset(t)}function WATCH(t,n){return $.components.on("watch",t,n)}function GET(t){return $.components.get(t)}function UPDATE(t){return $.components.update(t)}function INJECT(t,n,e,o){return $.components.inject(t,n,e,o)}function SCHEMA(t,n,e){return $.components.schema(t,n,e)}var $cmanager=new ComponentManager,COM_DATA_BIND_SELECTOR="input[data-component-bind],textarea[data-component-bind],select[data-component-bind]",COM_ATTR="[data-component]",COM_ATTR_URL="[data-component-url]",COM_ATTR_P="data-component-path",COM_ATTR_T="data-component-template",COM_ATTR_I="data-component-init";$.fn.component=function(){return this.data(COM_ATTR)},$.components=function(t){return $cmanager.isCompiling?$.components:$.components.compile(t)},$.components.compile=function(t){if($cmanager.isCompiling=!0,$.components.$inject(),$cmanager.pending.length>0)return $cmanager.pending.push(function(){$.components.compile(t)}),$.components;var n=t?t.find(COM_ATTR):$(COM_ATTR);return n.each(function(){var t=$(this),n=t.attr("data-component");if(!t.data(COM_ATTR)){var e=$cmanager.register[n||""];if(e){var o=e(t);o.$init=t.attr(COM_ATTR_I)||null,o.type=t.attr("data-component-type")||"",t.data(COM_ATTR,o);var a=t.attr(COM_ATTR_T)||o.template;if(a&&(o.template=a),"string"==typeof a){var r=function(n){o.prerender&&(n=prerender(n)),"function"==typeof o.make&&o.make(n),component_init(t,o)},i=a.substring(0,1);return void("."===i||"#"===i||"["===i?r($(i).html()):$.get($components_url(a),r))}if("string"==typeof o.make)return-1!==o.make.indexOf("<")?(o.prerender&&(o.make=o.prerender(o.make)),t.html(o.make),void component_init(t,o)):void $.get($components_url(o.make),function(n){o.prerender&&(n=prerender(n)),t.html(n),component_init(t,o)});o.make&&o.make(),component_init(t,o)}}}),void 0!==t?void $cmanager.next():0===$cmanager.toggle.length?void $cmanager.next():void component_async($cmanager.toggle,function(t,n){for(var e=0,o=t.toggle.length;o>e;e++)t.element.toggleClass(t.toggle[e]);n()},function(){$cmanager.next()})},$.components.$version="",$.components.$language="",$.components.$formatter=[],$.components.$parser=[],$.components.$inject=function(){var t=$(COM_ATTR_URL),n=[],e=0;t.each(function(){var t=$(this);t.data(COM_ATTR_URL)||(t.data(COM_ATTR_URL,"1"),n.push({element:t,cb:t.attr(COM_ATTR_I),path:t.attr(COM_ATTR_P),url:t.attr("data-component-url"),toggle:(t.attr("data-component-class")||"").split(" ")}))}),0!==n.length&&component_async(n,function(t,n){t.element.load($components_url(t.url),function(){if(t.path){var o=t.element.find(COM_ATTR);o.each(function(){var n=$(this);$.each(this.attributes,function(){this.specified&&n.attr(this.name,this.value.replace("$",t.path))})})}if(t.toggle.length>0&&""!==t.toggle[0]&&$cmanager.toggle.push(t),t.cb&&!t.element.attr("data-component")){var a=$cmanager.get(t.cb);"function"==typeof a&&a(t.element)}e++,n()})},function(){$cmanager.clear(),0!==e&&$.components.compile()})},$.components.inject=function(t,n,e){"function"==typeof n&&(timeout=e,e=n,n="body"),n||(n="body");var o=t.lastIndexOf(".");if(o=-1!==o?t.substring(o).toLowerCase():"",".js"===o){var a=d.createElement("script");return a.type="text/javascript",a.async=!0,a.onload=function(){e&&e()},a.src=Url,void document.getElementsByTagName("head")[0].appendChild(a)}if(".css"===o){var r=document.createElement("link");return r.type="text/css",r.rel="stylesheet",r.href="style.css",void document.getElementsByTagName("head")[0].appendChild(r)}if("body"===n){var i=Math.floor(1e5*Math.random()),c='data-component-injector="'+i+'"';$(n).append("<div "+c+"></div>"),n=$(n).find("> div["+c+"]")}return $(n).load($components_url(t),function(){$.components.compile(),e&&e()}),$.components},$.components.POST=function(t,n,e,o){return"number"==typeof e&&(o=e,e=void 0),setTimeout(function(){$.ajax($components_url(t),{type:"POST",data:JSON.stringify(n),success:function(t){return"string"==typeof e?$.components.set(e,t):void(e&&e(t))},contentType:"application/json"})},o||0),$.components},$.components.PUT=function(t,n,e,o){return"number"==typeof e&&(o=e,e=void 0),setTimeout(function(){$.ajax($components_url(t),{type:"PUT",data:JSON.stringify(n),success:function(t){return"string"==typeof e?$.components.set(e,t):void(e&&e(t))},contentType:"application/json"})},o||0),$.components},$.components.GET=function(t,n,e,o){return"number"==typeof e&&(o=e,e=void 0),setTimeout(function(){$.ajax($components_url(t),{type:"GET",data:n,success:function(t){return"string"==typeof e?$.components.set(e,t):void(e&&e(t))}})},o||0),$.components},$.components.DELETE=function(t,n,e,o){return"number"==typeof e&&(o=e,e=void 0),setTimeout(function(){$.ajax($components_url(t),{type:"DELETE",data:n,success:function(t){return"string"==typeof e?$.components.set(e,t):void(e&&e(t))}})},o||0),$.components},$.components.ready=function(t){return $cmanager.ready.push(t),$.components},$.components.watch=function(t,n){return $.components.on("watch",t,n),$.components},$.components.on=function(t,n,e){return"function"==typeof n?(e=n,n=""):n=n.replace(".*",""),$cmanager.events[n]?$cmanager.events[n][t]||($cmanager.events[n][t]=[]):($cmanager.events[n]={},$cmanager.events[n][t]=[]),$cmanager.events[n][t].push({fn:e,context:this,id:this._id}),$.components},$.components.version="v1.1.0",$.components.valid=function(t,n){var e="valid"+t;if("boolean"!=typeof n&&void 0!==$cmanager.cache[e])return $cmanager.cache[e];var o=!0,a=void 0!==n?[]:null;return $.components.each(function(t){void 0!==n&&(t.state&&a.push(t),t.$valid=n,t.$validate=!1),t.$valid===!1&&(o=!1)},t),$cmanager.cache[e]=o,$.components.state(a,1),o},$.components.$emit2=function(t,n,e){var o=$cmanager.events[n];if(!o)return!1;if(o=o[t],!o)return!1;for(var a=0,r=o.length;r>a;a++)o[a].fn.apply(o[a].context,e);return!0},$.components.$emitonly=function(t,n,e,o){for(var a={},r=Object.keys(n),i=0,c=r.length;c>i;i++)for(var s=r[i].split("."),p="",m=0,u=s.length;u>m;m++)p+=(p?".":"")+s[m],a[p]=n[p];return $.components.$emit2(t,"*",[o,a[o]]),Object.keys(a).forEach(function(n){$.components.$emit2(t,n,[o,a[n]])}),this},$.components.$emit=function(t,n){if(n){for(var e=n.split("."),o=[],a="watch"===t?1:2,r=arguments.length;r>a;a++)o.push(arguments[a]);$.components.$emit2(t,"*",o);for(var i="",a=0,r=e.length;r>a;a++){var c=e[a],s=e[a];if("]"===s.substring(s.length-1,s.length)){var p=s.lastIndexOf("[");s=s.substring(0,p)}i+=a>0?".":"",o[1]=$.components.get(i+c),$.components.$emit2(t,i+c,o),c!==s&&$.components.$emit2(t,i+s,o),i+=c}return!0}},$.components.emit=function(t){var n=$cmanager.events[""];if(!n)return!1;if(n=$cmanager.events[""][t],!n)return!1;for(var e=[],o=1,a=arguments.length;a>o;o++)e.push(arguments[o]);for(var o=0,a=n.length;a>o;o++)n[o].fn.apply(n[o].context,e);return!0},$.components.change=function(t,n){return void 0===n?!$.components.dirty(t):!$.components.dirty(t,!n)},$.components.dirty=function(t,n){var e="dirty"+t;if("boolean"!=typeof n&&void 0!==$cmanager.cache[e])return $cmanager.cache[e];var o=!0,a=void 0!==n?[]:null;return $.components.each(function(t){void 0!==n&&(t.state&&a.push(t),t.$dirty=n),t.$dirty===!1&&(o=!1)},t),$cmanager.cache[e]=o,$.components.state(a,2),o},$.components.update=function(t){t=t.replace(".*","");var n=[],e=t.length,o=!1,a={};$.components.each(function(r){if(!(e>0)||r.path&&r.path.substring(0,e)===t){var i=r.get();r.setter&&r.setter(i),r.validate&&r.valid(r.validate(i),!0),r.state&&n.push(r),null!==r.watch&&r.watch(i,1),r.path===t&&(o=!0),a[r.path]=i}}),a[t]||(a[t]=$.components.get(t));for(var r=0,e=n.length;e>r;r++)n[r].state(1);return $.components.$emitonly("watch",a,1,t),$.components},$.components.set=function(t,n,e){if($cmanager.set(t,n),"object"==typeof n&&!(n instanceof Array)&&null!==n&&void 0!==n)return $.components.update(t);var o=$cmanager.get(t),a=[];void 0===e&&(e=1),$.components.each(function(t){t.setter&&t.setter(o,e),t.validate&&t.valid(t.validate(o),!0),t.state&&a.push(t),null!==t.watch&&t.watch(o,e)},t);for(var r=0,i=a.length;i>r;r++)a[r].state(e);return $.components.$emit("watch",t,void 0,e),$.components},$.components.get=function(t){return $cmanager.get(t)},$.components.remove=function(t){return $cmanager.clear(),$.components.each(function(t){t.remove(!0)},t),$cmanager.cleaner(),$.components},$.components.validate=function(t){var n=[],e=!0;return $.components.each(function(t){var o=t.path;t.state&&n.push(t),t.$validate=!0,t.validate&&(t.$valid=t.validate($cmanager.get(o)),t.$valid||(e=!1))},t),$cmanager.clear("valid"),n.length>0&&$.components.state(n,1),$.components.$emit("validate",t),e},$.components.invalid=function(t){var n=[];return $.components.each(function(t){t.$valid===!1&&n.push(t)},t),n},$.components.can=function(t){return!$.components.dirty(t)&&$.components.valid(t)},$.components.disable=function(t){return $.components.dirty(t)||!$.components.valid(t)},$.components.state=function(t,n){if(t&&0!==t.length)for(var e=0,o=t.length;o>e;e++)t[e].state(n)},$.components.reset=function(t){var n=[];return $.components.each(function(t){t.state&&n.push(t),t.$dirty=!0,t.$valid=!0,t.$validate=!1,t.validate&&(t.$valid=t.validate(t.get(),3))},t),$cmanager.clear(),$.components.state(n,3),$.components.$emit("reset",t),$.components},$.components.findByName=function(t,n,e){"function"==typeof n&&(e=n,n=void 0);var o,a="function"==typeof e;return $.components.each(function(n){return n.name===t?a?void e(n):(o=n,!0):void 0},n),a?$.components:o},$.components.findByPath=function(t,n){"function"==typeof t&&(n=t,t=void 0);var e,o="function"==typeof n;return $.components.each(function(t){return o?void n(t):(e=t,!0)},t),o?$.components:e},$.components.findById=function(t,n,e){"function"==typeof n&&(e=n,n=void 0);var o,a="function"==typeof e;return $.components.each(function(n){return n.id===t?a?void e(n):(o=n,!0):void 0},n),a?$.components:o},$.components.schema=function(t,n,e){if(!n)return $.extend(!0,{},$cmanager.schemas[t]);if("object"==typeof n)return $cmanager.schemas[t]=n,n;if("function"==typeof n){var o=n();return $cmanager.schemas[t]=o,o}if("string"!=typeof n)return void 0;var a=n.substring(0,1),r=n.substring(n.length-1);if('"'===a&&'"'===r||"["===a&&"]"===r||"{"===a&&"}"===r){var i=JSON.parse(n);return $cmanager.schemas[t]=i,e&&e(i),i}$.get($components_url(n),function(n){"string"==typeof n&&(n=JSON.parse(n)),$cmanager.schemas[t]=n,e&&e(n)})},$.components.each=function(t,n){var e=n?-1!==n.lastIndexOf("*"):!1;e&&(n=n.replace(".*","").replace("*",""));for(var o=0,a=$cmanager.components.length;a>o;o++){var r=$cmanager.components[o];if(n){if(!r.path)continue;if(e){if(0!==r.path.indexOf(n))continue}else if(n!==r.path)continue}if(r&&!r.$removed){var i=t(r);if(i===!0)return $.components}}return $.components},Component.prototype.html=function(t){return this.element.html(t)},Component.prototype.isInvalid=function(){var t=!this.$valid;return t&&!this.$validate&&(t=!this.$dirty),t},Component.prototype.valid=function(t,n){return void 0===t?this.$valid:(this.$valid=t,this.$validate=!1,$cmanager.clear("valid"),n?this:(this.state&&this.state(1),this))},Component.prototype.change=function(t){return void 0===t?!this.dirty():this.dirty(!t)},Component.prototype.dirty=function(t){return void 0===t?this.$dirty:(this.$dirty=t,$cmanager.clear("dirty"),this.state&&this.state(2),this)},Component.prototype.remove=function(t){this.destroy&&this.destroy(),this.element.removeData(COM_ATTR),this.element.find(COM_DATA_BIND_SELECTOR).unbind("change"),this.element.remove(),t||$cmanager.clear(),$.components.$removed=!0,$.components.state(void 0,"destroy",this),$.components.$emit("destroy",this.name,this.element.attr(COM_ATTR_P)),t?$cmanager.refresh():$cmanager.cleaner()},Component.prototype.on=function(t,n,e){return"function"==typeof n?(e=n,n=""):n=n.replace(".*",""),$cmanager.events[n]?$cmanager.events[n][t]||($cmanager.events[n][t]=[]):($cmanager.events[n]={},$cmanager.events[n][t]=[]),$cmanager.events[n][t].push({fn:e,context:this,id:this._id}),this},Component.prototype.formatter=function(t,n){for(var e=n?$.components.$formatter:this.$formatter,o=0,a=e.length;a>o;o++)t=e[o].call(this,this.path,t,this.type);return t},Component.prototype.parser=function(t,n){for(var e=n?$.components.$parser:this.$parser,o=0,a=e.length;a>o;o++)t=e[o].call(this,this.path,t,this.type);return t},Component.prototype.emit=function(){$.components.emit.apply($.components,arguments)},Component.prototype.get=function(t){return t||(t=this.path),t?$cmanager.get(t):void 0},Component.prototype.set=function(t,n,e){var o=this;return void 0===n&&(n=t,t=this.path),t?($.components.set(t,n,e,o),o):o},ComponentManager.prototype.initialize=function(){var t=this.init.pop();return void 0===t?($.components.compile(),this):(this.prepare(t),this.initialize(),this)},ComponentManager.prototype.prepare=function(t){if(!t)return this;var n=t.get(),e=t.element;if(t.id=e.attr("data-component-id")||name,t.setter&&t.setter(n),t.validate&&(t.$valid=t.validate(t.get(),0)),t.done&&t.done(),t.state&&t.state(0),null!==t.watch&&t.watch(n,0),t.$init){var o=$.components.get(t.$init);"function"==typeof o&&o.call(t,t)}e.trigger("component"),e.off("component");var a=e.attr("data-component-class");if(a){a=a.split(" ");for(var r=0,i=a.length;i>r;r++)e.toggleClass(a[r])}return t.id&&$.components.emit("#"+t.id,t),$.components.emit("component",t),this},ComponentManager.prototype.next=function(){var t=this.pending.shift();return void 0===t?(this.isReady&&(this.isCompiling=!1),this):void t()},ComponentManager.prototype.clear=function(t){for(var n=this,e=Object.keys(n.cache),o=0,a=e.length;a>o;o++){var r=e[o];t?r.substring(0,t.length)===t&&delete n.cache[r]:delete n.cache[r]}return n},ComponentManager.prototype.refresh=function(){var t=this;return t.components=[],$(COM_ATTR).each(function(){var n=$(this).data(COM_ATTR);n&&n.element&&t.components.push(n)}),t},ComponentManager.prototype.get=function(t){if(void 0!==t){for(var n=window,e=0,t=t.split("."),o=t.length;o>e;e++){if(!n)return;var a=t[e];if("]"===a.substring(a.length-1,a.length)){var r=a.lastIndexOf("[");index=parseInt(a.substring(r+1,a.length-1)),a=a.substring(0,r),n=n[a][index]}else n=n[a]}return n}},ComponentManager.prototype.set=function(t,n){var e=this;if(!t)return e;for(var o=window,a="function"==typeof n,r=0,t=t.split("."),i=t.length;i>r;r++){var c=t[r],s=-1;if("]"===c.substring(c.length-1,c.length)){var p=c.lastIndexOf("[");s=parseInt(c.substring(p+1,c.length-1)),c=c.substring(0,p)}if(!o)return;i-1===r?-1===s?o[c]=a?n(o[c]):n:o[c][s]=a?n(o[c][s]):n:o=-1===s?o[c]:o[c][s]}return e},ComponentManager.prototype.cleaner=function(){for(var t=this,n=Object.keys(t.events),e=!1,o=0,a=n.length;a>o;o++){var r=n[o];if(t.events[r])for(var i=Object.keys(t.events[r]),c=0,s=i.length;s>c;c++){var p=i[c],m=t.events[r][p];if(m)for(var u=0;;){var $=m[u++];if(void 0===$)break;void 0!==$.context&&null!==$.context&&$.context.element&&0===$.context.element.parent().length&&($.context=null,t.events[r][p].splice(u-1,1),0===t.events[r][p].length&&(delete t.events[r][p],0===Object.keys(t.events[r]).length&&delete t.events[r]),u-=2,e=!0)}}}return e?(t.refresh(),t):t},COMPONENT("",function(){var t=this.element.get(0).tagName;"INPUT"===t||"SELECT"===t||"TEXTAREA"===t||this.element.find(COM_DATA_BIND_SELECTOR).length>0||(this.getter=null,this.setter=function(t){t=this.formatter(t,!0),this.element.html(t)})}),setInterval(function(){$cmanager.cleaner()},6e4),$.components.compile(),$(document).ready(function(){setTimeout(function(){$.components.compile()},2),setTimeout(function(){$cmanager.cleaner()},3e3)});
var LIMIT_HISTORY=100,LIMIT_HISTORY_ERROR=100,JRFU={},jRouting={version:101,cache:{},routes:[],history:[],errors:[],events:{},eventsOnce:{},global:{},query:{},middlewares:{},repository:{},url:"",model:null,isFirst:!0,isReady:!1,isRefresh:!1,isSkip:!1,isModernBrowser:"undefined"!=typeof history.pushState,count:0};jRouting.on=function(t,r){var n=this,e=n.events[t];return e?(e.push(r),n):(n.events[t]=[r],n)},jRouting.once=function(t,r){var n=this,e=n.eventsOnce[t];return e?(e.push(r),n):(n.eventsOnce[t]=[r],n)},jRouting.emit=function(t){var r=this,n=r.events[t]||[],e=r.eventsOnce[t]||[],i=n.length,o=e.length;if(0===i&&0===o)return r;for(var u=[],a=arguments.length,s=1;a>s;s++)u.push(arguments[s]);if(i>0)for(var s=0;i>s;s++)n[s].apply(r,u);if(o>0){for(var s=0;i>s;s++)e[s].apply(r,u);delete r.eventsOnce[t]}},jRouting.route=function(t,r,n,e){var i;if(r instanceof Array){var i=n;n=r,r=i}"function"==typeof n&&(i=e,e=n,n=i);var o=this,u=t.count("/")+(-1===t.indexOf("*")?0:10),a=o._route(t.trim()),s=[];if("string"==typeof n&&(n=n.split(",")),-1!==t.indexOf("{")){for(var f=0;f<a.length;f++)"{"===a[f].substring(0,1)&&s.push(f);u-=s.length}return o.routes.push({url:a,fn:r,priority:u,params:s,middleware:n||null,init:e,count:0,once:!1}),o.routes.sort(function(t,r){return t.priority>r.priority?-1:t.priority<r.priority?1:0}),o},jRouting.middleware=function(t,r){var n=this;return n.middlewares[t]=r,n},jRouting.refresh=function(){var t=this;return t.location(t,!0)},jRouting._route=function(t){t=t.toLowerCase(),"/"===t.charIndex(0)&&(t=t.substring(1)),"/"===t.charIndex(t.length-1)&&(t=t.substring(0,t.length-1));var r=t.split("/");return 1===r.length&&""===r[0]&&(r[0]="/"),r},jRouting._route_param=function(t,r){var n=[];if(!r||!t)return n;var e=r.params.length;if(0===e)return n;for(var i=0;e>i;i++){var o=t[r.params[i]];n.push("/"===o?"":o)}return n},jRouting._route_compare=function(t,r){var n=t.length,e=1===n&&"/"===t[0];if(r.length!==n)return!1;for(var i=0;n>i;i++){var o=r[i];if("undefined"==typeof o)return!1;if(e||"{"!==o.charIndex(0)){if("*"===o)return!0;if(t[i]!==o)return!1}}return!0},jRouting.location=function(t,r){var n=t.indexOf("?");-1!==n&&(t=t.substring(0,n)),t=JRFU.prepareUrl(t),t=JRFU.path(t);var e=this,i=e._route(t),o=[],u=!0;e.isRefresh=r||!1,e.count++,r||e.url.length>0&&e.history[e.history.length-1]!==e.url&&(e.history.push(e.url),e.history.length>LIMIT_HISTORY&&e.history.shift());for(var a=e.routes.length,s=0;a>s;s++){var f=e.routes[s];e._route_compare(i,f.url)&&(-1===f.url.indexOf("*")&&(u=!1),f.once&&f.count>0||(f.count++,o.push(f)))}var p=!1,c=[];e.url.length>0&&(e.cache[e.url]=e.repository),e.url=t,e.repository=e.cache[t],void 0===e.repository&&(e.repository={}),e._params(),e.emit("location",t),a=o.length;for(var s=0;a>s;s++){var f=o[s];if(f.middleware&&0!==f.middleware.length)!function(t){for(var r=t.middleware.length,n=[],o=0;r>o;o++)!function(t,r){n.push(function(n){r.call(e,n,t)})}(t,jRouting.middlewares[t.middleware[o]]);return t.init?(t.init(function(){t.init=null,n.async(function(){t.fn.apply(e,e._route_param(i,t))})}),void 0):(n.async(function(){t.fn.apply(e,e._route_param(i,t))}),void 0)}(f);else{if(!f.init){f.fn.apply(e,e._route_param(i,f));continue}!function(t){t.init(function(){t.init=null,t.fn.apply(e,e._route_param(i,t))})}(f)}}p&&e.status(500,c),u&&e.status(404,new Error("Route not found."))},jRouting.back=function(){var t=this,r=t.history.pop()||"/";return t.url="",t.redirect(r,!0),t},jRouting.status=function(t,r){var n=this;return n.emit("status",t||404,r),n},jRouting.redirect=function(t,r){var n=this;return n.isSkip=!0,history.pushState(null,null,t),n.model=r||null,n.location(t,!1),n},jRouting.cookie={read:function(t){for(var r=document.cookie.split(";"),n=0;n<r.length;n++){var e=r[n];" "===e.charAt(0)&&(e=e.substring(1));var i=e.split("=");if(i.length>1&&i[0]===t)return i[1]}return""},write:function(t,r,n){var e="";if("number"==typeof n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3),e="; expires="+i.toGMTString()}else n instanceof Date&&(e="; expires="+n.toGMTString());document.cookie=t+"="+r+e+"; path=/"},remove:function(t){this.write(t,"",-1)}},jRouting._params=function(){for(var t=this,r={},n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),e=0;e<n.length;e++){var i=n[e].split("=");if(2===i.length){var o=decodeURIComponent(i[0]),u=decodeURIComponent(i[1]),a=r[o]instanceof Array;"undefined"==typeof r[o]||a||(r[o]=[r[o]]),a?r[o].push(u):r[o]=u}}return t.query=r,t},JRFU.path=function(t,r){"undefined"==typeof r&&(r="/");var n=t.indexOf("?"),e="";-1!==n&&(e=t.substring(n),t=t.substring(0,n));var i=t.charIndex(t.length-1);return i!==r&&(t+=r),t+e},Array.prototype.forEach||(Array.prototype.forEach=function(t){for(var r=this,n=0;n<r.length;n++)t(r[n],n);return r}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){for(var r=this,n=0;n<r.length;n++)if(t===r[n])return n;return-1}),$(window).bind("popstate",function(){if(1===jRouting.count||jRouting.isSkip)return jRouting.isSkip=!1,void 0;var t=window.location.hash||"";0===t.length&&(t=window.location.pathname),jRouting.location(JRFU.path(t))}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s]+|[\s]+$/g,"")}),String.prototype.count||(String.prototype.count=function(t){var r=0,n=0;do r=this.indexOf(t,r+t.length),r>0&&n++;while(r>0);return n}),String.prototype.charIndex||(String.prototype.charIndex=function(t){return this.toString().substring(t,t+1)}),JRFU.path=function(t,r){"undefined"==typeof r&&(r="/");var n=t.indexOf("?"),e="";-1!==n&&(e=t.substring(n),t=t.substring(0,n));var i=t.charIndex(t.length-1);return i!==r&&(t+=r),t+e},JRFU.prepareUrl=function(t){return index=t.indexOf("#"),-1!==index?t.substring(0,index):t},Array.prototype.async||(Array.prototype.async=function(t){var r=this,n=r.shift();return void 0===n?(t&&t(),r):(n(function(){setTimeout(function(){r.async(t)},1)}),r)}),jRouting.on("error",function(t,r,n){var e=this;e.errors.push({error:t,url:r,name:n,date:new Date}),e.errors.length>LIMIT_HISTORY_ERROR&&e.errors.shift()}),$.fn.jRouting=function(){var t=function(t){t.preventDefault(),jRouting.redirect($(this).attr("href"))};return this.filter("a").bind("click",t),this},$(document).ready(function(){var t=window.location.pathname;if(jRouting.isReady=!0,"undefined"==typeof jRouting.events.ready)jRouting.location(JRFU.path(JRFU.prepareUrl(t)));else{var r=JRFU.path(JRFU.prepareUrl(t));jRouting.emit("ready",r),jRouting.emit("load",r)}});