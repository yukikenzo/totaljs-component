function $components_ready(){clearTimeout($cmanager.timeout),$cmanager.timeout=setTimeout(function(){$cmanager.initialize();var t=$cmanager.components.length;if($(document).trigger("components",[t]),$cmanager.isReady||($cmanager.clear(),$cmanager.isReady=!0,$.components.emit("init"),$.components.emit("ready")),$cmanager.ready){for(var e=$cmanager.ready,n=0,a=e.length;a>n;n++)e[n](t);delete $cmanager.ready}},100)}function component_init(t,e){function n(t,n){var a=t.get(0),o=t.attr("data-component-bind");if(!(o&&o.length>0&&o!==e.path)&&e.getter){e.dirty(!1);var r="checkbox"===a.type?a.checked:t.val();if(e.$value===r)return void(n&&e.setter(e.get()));e.$value=r,e.dirty(!1),e.getter(r,2),n&&e.setter(e.get())}}function a(t){var e=$(this);if("SELECT"!==this.tagName&&"blur"===t.type)return clearTimeout(e.data("delay")),e.data("skip",t.type),void n(e,!0);if("change"===t.type){if("SELECT"!==this.tagName){var a=this.type.toLowerCase();if("checkbox"!==a&&"radio"!==a)return;return void n(e)}return void n(e)}var o=e.data("skip");return o&&o!==t.type?void e.removeData("skip"):(clearTimeout(e.data("delay")),void e.data("delay",setTimeout(function(){e.data("skip",t.type),n(e)},300)))}var o=t.get(0).tagName;"INPUT"===o||"SELECT"===o||"TEXTAREA"===o?""===e.type&&(e.$input=!0,t.bind("change blur keydown",a).attr("data-component-bind",e.path)):t.find(COM_DATA_BIND_SELECTOR).bind("change blur keydown",a).attr("data-component-bind",e.path),$cmanager.components.push(e),$cmanager.init.push(e),$.components(t),$components_ready()}function Component(t){this._id="component"+Math.floor(1e5*Math.random()),this.$dirty=!0,this.$valid=!0,this.$validate=!1,this.$parser=[],this.$formatter=[],this.$value,this.$skip=!1,this.name=t,this.path,this.type,this.id,this.make,this.done,this.watch=null,this.prerender,this.destroy,this.state,this.validate,this.getter=function(t,e){return t=this.parser(t),2===e&&(this.$skip=!0),this.set(this.path,t,e),this},this.setter=function(t,e){var n=this;if(2===e&&n.$skip===!0)return n.$skip=!1,n;var a=n.$input===!0?this.element:this.element.find(COM_DATA_BIND_SELECTOR);t=n.formatter(t);var o=null!==t&&void 0!==t?t.toString().toLowerCase():"";a.each(function(){var e=$(this),a=e.attr("data-component-bind");return a&&a.length>0&&a!==n.path?void 0:"checkbox"===this.type?(n.$value="true"===o||"1"===o||"on"===o,void(this.checked=n.$value)):((void 0===t||null===t)&&(t=""),"select-one"===this.type?(n.$value=t,void e.val(t)):void(n.$value=this.value=t))})},this.$parser.push(function(t,e,n){if("number"===n){"string"==typeof e&&(e=e.replace(/\s/g,"").replace(/,/g,"."));var a=parseFloat(e);return isNaN(a)&&(a=null),a}return e})}function COMPONENT(t,e){var n=function(n){var a=new Component(t);return a.element=n,a.path=n.attr(COM_ATTR_P),e.call(a),a};$cmanager.register[t]=n}function component_async(t,e,n){var a=t.shift();return void 0===a?void(n&&n()):void e(a,function(){component_async(t,e,n)})}function ComponentManager(){this.isReady=!1,this.init=[],this.register={},this.cache={},this.model={},this.components=[],this.toggle=[],this.ready=[],this.events={},this.timeout,this.pending=[]}var $cmanager=new ComponentManager,COM_DATA_BIND_SELECTOR="input[data-component-bind],textarea[data-component-bind],select[data-component-bind]",COM_ATTR="[data-component]",COM_ATTR_URL="[data-component-url]",COM_ATTR_P="data-component-path",COM_ATTR_T="data-component-template",COM_ATTR_I="data-component-init";$.fn.component=function(){return this.data(COM_ATTR)},$.components=function(t){if($.components.inject(),$cmanager.pending.length>0)return $cmanager.pending.push(function(){$.components(t)}),self;var e=t?t.find(COM_ATTR):$(COM_ATTR);return e.each(function(){var t=$(this),e=t.attr("data-component");if(!t.data(COM_ATTR)){var n=$cmanager.register[e||""];if(n){var a=n(t);a.$init=t.attr(COM_ATTR_I)||null,a.type=t.attr("data-component-type")||"",t.data(COM_ATTR,a);var o=t.attr(COM_ATTR_T)||a.template;if(o&&(a.template=o),"string"==typeof o){var r=function(e){a.prerender&&(e=prerender(e)),"function"==typeof a.make&&a.make(e),component_init(t,a)},i=o.substring(0,1);return void("."===i||"#"===i||"["===i?r($(i).html()):$.get(o,r))}if("string"==typeof a.make)return-1!==a.make.indexOf("<")?(a.prerender&&(a.make=a.prerender(a.make)),t.html(a.make),void component_init(t,a)):void $.get(a.make,function(e){a.prerender&&(e=prerender(e)),t.html(e),component_init(t,a)});a.make&&a.make(),component_init(t,a)}}}),void 0!==t?void $cmanager.next():0===$cmanager.toggle.length?void $cmanager.next():void component_async($cmanager.toggle,function(t,e){for(var n=0,a=t.toggle.length;a>n;n++)t.element.toggleClass(t.toggle[n]);e()},function(){$cmanager.next()})},$.components.$formatter=[],$.components.$parser=[],$.components.inject=function(){var t=$(COM_ATTR_URL),e=[],n=0;t.each(function(){var t=$(this);t.data(COM_ATTR_URL)||(t.data(COM_ATTR_URL,"1"),e.push({element:t,path:t.attr(COM_ATTR_P),url:t.attr("data-component-url"),toggle:(t.attr("data-component-class")||"").split(" ")}))}),0!==e.length&&component_async(e,function(t,e){t.element.load(t.url,function(){if(t.path){var a=t.element.find(COM_ATTR);a.each(function(){var e=$(this);$.each(this.attributes,function(){this.specified&&e.attr(this.name,this.value.replace("$",t.path))})})}t.toggle.length>0&&""!==t.toggle[0]&&$cmanager.toggle.push(t),n++,e()})},function(){$cmanager.clear(),0!==n&&$.components()})},$.components.ready=function(t){$cmanager.ready.push(t)},$.components.watch=function(t,e){return $.components.on("watch",t,e),$.components},$.components.on=function(t,e,n){return"function"==typeof e?(n=e,e=""):e=e.replace(".*",""),$cmanager.events[e]?$cmanager.events[e][t]||($cmanager.events[e][t]=[]):($cmanager.events[e]={},$cmanager.events[e][t]=[]),$cmanager.events[e][t].push({fn:n,context:this,id:this._id}),$.components},$.components.version="v1.0.0",$.components.valid=function(t,e){var n="valid"+t;if("boolean"!=typeof e&&void 0!==$cmanager.cache[n])return $cmanager.cache[n];var a=!0,o=void 0!==e?[]:null;return $.components.each(function(t){void 0!==e&&(t.state&&o.push(t),t.$valid=e,t.$validate=!1),t.$valid===!1&&(a=!1)},t),$cmanager.cache[n]=a,$.components.state(o,1),a},$.components.$emit2=function(t,e,n){var a=$cmanager.events[e];if(!a)return!1;if(a=a[t],!a)return!1;for(var o=0,r=a.length;r>o;o++)a[o].fn.apply(a[o].context,n);return!0},$.components.$emitonly=function(t,e,n,a){for(var o={},r=Object.keys(e),i=0,c=r.length;c>i;i++)for(var s=r[i].split("."),p="",m=0,h=s.length;h>m;m++)p+=(p?".":"")+s[m],o[p]=e[p];return $.components.$emit2(t,"*",[a,o[a]]),Object.keys(o).forEach(function(e){$.components.$emit2(t,e,[a,o[e]])}),this},$.components.$emit=function(t,e){if(e){for(var n=e.split("."),a=[],o="watch"===t?1:2,r=arguments.length;r>o;o++)a.push(arguments[o]);$.components.$emit2(t,"*",a);for(var i="",o=0,r=n.length;r>o;o++){var c=n[o],s=n[o];if("]"===s.substring(s.length-1,s.length)){var p=s.lastIndexOf("[");s=s.substring(0,p)}i+=o>0?".":"",a[1]=$.components.get(i+c),$.components.$emit2(t,i+c,a),c!==s&&$.components.$emit2(t,i+s,a),i+=c}return!0}},$.components.emit=function(t){var e=$cmanager.events[""];if(!e)return!1;if(e=$cmanager.events[""][t],!e)return!1;for(var n=[],a=1,o=arguments.length;o>a;a++)n.push(arguments[a]);for(var a=0,o=e.length;o>a;a++)e[a].fn.apply(e[a].context,n);return!0},$.components.change=function(t,e){return void 0===e?!$.components.dirty(t):!$.components.dirty(t,!e)},$.components.dirty=function(t,e){var n="dirty"+t;if("boolean"!=typeof e&&void 0!==$cmanager.cache[n])return $cmanager.cache[n];var a=!0,o=void 0!==e?[]:null;return $.components.each(function(t){void 0!==e&&(t.state&&o.push(t),t.$dirty=e),t.$dirty===!1&&(a=!1)},t),$cmanager.cache[n]=a,$.components.state(o,2),a},$.components.update=function(t){t=t.replace(".*","");var e=[],n=t.length,a=!1,o={};$.components.each(function(r){if(!(n>0)||r.path&&r.path.substring(0,n)===t){var i=r.get();r.setter&&r.setter(i),r.validate&&r.valid(r.validate(i),!0),r.state&&e.push(r),null!==r.watch&&r.watch(i,1),r.path===t&&(a=!0),o[r.path]=i}}),o[t]||(o[t]=$.components.get(t));for(var r=0,n=e.length;n>r;r++)e[r].state(1);return $.components.$emitonly("watch",o,1,t),$.components},$.components.set=function(t,e,n){if($cmanager.set(t,e),"object"==typeof e&&!(e instanceof Array)&&null!==e&&void 0!==e)return $.components.update(t);var a=$cmanager.get(t),o=[];void 0===n&&(n=1),$.components.each(function(t){t.setter&&t.setter(a,n),t.validate&&t.valid(t.validate(a),!0),t.state&&o.push(t),null!==t.watch&&t.watch(a,n)},t);for(var r=0,i=o.length;i>r;r++)o[r].state(n);return $.components.$emit("watch",t,void 0,n),$.components},$.components.get=function(t){return $cmanager.get(t)},$.components.remove=function(t){return $cmanager.clear(),$.components.each(function(t){t.remove(!0)},t),$cmanager.cleaner(),$.components},$.components.validate=function(t){var e=[],n=!0;return $.components.each(function(t){var a=t.path;t.state&&e.push(t),t.$validate=!0,t.validate&&(t.$valid=t.validate($cmanager.get(a)),t.$valid||(n=!1))},t),$cmanager.clear("valid"),e.length>0&&$.components.state(e,1),$.components.$emit("validate",t),n},$.components.invalid=function(t){var e=[];return $.components.each(function(t){t.$valid===!1&&e.push(t)},t),e},$.components.state=function(t,e){if(t&&0!==t.length)for(var n=0,a=t.length;a>n;n++)t[n].state(e)},$.components.reset=function(t){var e=[];return $.components.each(function(t){t.state&&e.push(t),t.$dirty=!0,t.$valid=!0,t.$validate=!1,t.validate&&(t.$valid=t.validate(t.get(),3))},t),$cmanager.clear(),$.components.state(e,3),$.components.$emit("reset",t),$.components},$.components.each=function(t,e){var n=e?-1!==e.lastIndexOf("*"):!1;n&&(e=e.replace(".*","").replace("*",""));for(var a=0,o=$cmanager.components.length;o>a;a++){var r=$cmanager.components[a];if(e){if(!r.path)continue;if(n){if(0!==r.path.indexOf(e))continue}else if(e!==r.path)continue}r&&!r.$removed&&t(r)}return $.components},Component.prototype.valid=function(t,e){return void 0===t?this.$valid:(this.$valid=t,this.$validate=!1,$cmanager.clear("valid"),e?this:(this.state&&this.state(1),this))},Component.prototype.change=function(t){return void 0===t?!this.dirty():this.dirty(!t)},Component.prototype.dirty=function(t){return void 0===t?this.$dirty:(this.$dirty=t,$cmanager.clear("dirty"),this.state&&this.state(2),this)},Component.prototype.remove=function(t){this.destroy&&this.destroy(),this.element.removeData(COM_ATTR),this.element.find(COM_DATA_BIND_SELECTOR).unbind("change"),this.element.remove(),t||$cmanager.clear(),$.components.$removed=!0,$.components.state(void 0,"destroy",this),$.components.$emit("destroy",this.name,this.element.attr(COM_ATTR_P)),t?$cmanager.refresh():$cmanager.cleaner()},Component.prototype.on=function(t,e,n){return"function"==typeof e?(n=e,e=""):e=e.replace(".*",""),$cmanager.events[e]?$cmanager.events[e][t]||($cmanager.events[e][t]=[]):($cmanager.events[e]={},$cmanager.events[e][t]=[]),$cmanager.events[e][t].push({fn:n,context:this,id:this._id}),this},Component.prototype.formatter=function(t,e){for(var n=e?$.components.$formatter:this.$formatter,a=0,o=n.length;o>a;a++)t=n[a].call(this,this.path,t,this.type);return t},Component.prototype.parser=function(t,e){for(var n=e?$.components.$parser:this.$parser,a=0,o=n.length;o>a;a++)t=n[a].call(this,this.path,t,this.type);return t},Component.prototype.emit=function(){$.components.emit.apply($.components,arguments)},Component.prototype.get=function(t){return t||(t=this.path),t?$cmanager.get(t):void 0},Component.prototype.set=function(t,e,n){var a=this;return void 0===e&&(e=t,t=this.path),t?($.components.set(t,e,n,a),a):a},ComponentManager.prototype.initialize=function(){var t=this.init.pop();return void 0===t?($.components(),this):(this.prepare(t),this.initialize(),this)},ComponentManager.prototype.prepare=function(t){if(!t)return this;var e=t.get(),n=t.element;if(t.id=n.attr("data-component-id")||name,t.setter&&t.setter(e),t.validate&&(t.$valid=t.validate(t.get(),0)),t.done&&t.done(),t.state&&t.state(0),null!==t.watch&&t.watch(e,0),t.$init){var a=$.components.get(t.$init);"function"==typeof a&&a.call(t)}n.trigger("component"),n.off("component");var o=n.attr("data-component-class");if(o){o=o.split(" ");for(var r=0,i=o.length;i>r;r++)n.toggleClass(o[r])}return $.components.emit("component",t),this},ComponentManager.prototype.next=function(){var t=this.pending.shift();return void 0===t?this:void t()},ComponentManager.prototype.clear=function(t){for(var e=this,n=Object.keys(e.cache),a=0,o=n.length;o>a;a++){var r=n[a];t?r.substring(0,t.length)===t&&delete e.cache[r]:delete e.cache[r]}return e},ComponentManager.prototype.refresh=function(){var t=this;return t.components=[],$(COM_ATTR).each(function(){var e=$(this).data(COM_ATTR);e&&e.element&&t.components.push(e)}),t},ComponentManager.prototype.ready=function(){var t=this;return 0===t.init.length?t:void 0},ComponentManager.prototype.get=function(t){if(void 0!==t){for(var e=window,n=0,t=t.split("."),a=t.length;a>n;n++){if(!e)return;var o=t[n];if("]"===o.substring(o.length-1,o.length)){var r=o.lastIndexOf("[");index=parseInt(o.substring(r+1,o.length-1)),o=o.substring(0,r),e=e[o][index]}else e=e[o]}return e}},ComponentManager.prototype.set=function(t,e){var n=this;if(!t)return n;for(var a=window,o="function"==typeof e,r=0,t=t.split("."),i=t.length;i>r;r++){var c=t[r],s=-1;if("]"===c.substring(c.length-1,c.length)){var p=c.lastIndexOf("[");s=parseInt(c.substring(p+1,c.length-1)),c=c.substring(0,p)}if(!a)return;i-1===r?-1===s?a[c]=o?e(a[c]):e:a[c][s]=o?e(a[c][s]):e:a=-1===s?a[c]:a[c][s]}return n},ComponentManager.prototype.cleaner=function(){for(var t=this,e=Object.keys(t.events),n=!1,a=0,o=e.length;o>a;a++){var r=e[a];if(t.events[r])for(var i=Object.keys(t.events[r]),c=0,s=i.length;s>c;c++){var p=i[c],m=t.events[r][p];if(m)for(var h=0;;){var l=m[h++];if(void 0===l)break;void 0!==l.context&&null!==l.context&&l.context.element&&0===l.context.element.parent().length&&(l.context=null,t.events[r][p].splice(h-1,1),0===t.events[r][p].length&&(delete t.events[r][p],0===Object.keys(t.events[r]).length&&delete t.events[r]),h-=2,n=!0)}}}return n?(t.refresh(),t):t},COMPONENT("",function(){var t=this.element.get(0).tagName;"INPUT"===t||"SELECT"===t||"TEXTAREA"===t||this.element.find(COM_DATA_BIND_SELECTOR).length>0||(this.getter=null,this.setter=function(t){t=this.formatter(t,!0),this.element.html(t)})}),setInterval(function(){$cmanager.cleaner()},6e4),$.components(),$(document).ready(function(){$.components(),setTimeout(function(){$cmanager.cleaner()},3e3)});